<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Docker笔记 | 怺恆のBLOG</title><meta name="author" content="TROUVAILLE"><meta name="copyright" content="TROUVAILLE"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Docker基础">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker笔记">
<meta property="og:url" content="http://example.com/2023/08/08/Docker/index.html">
<meta property="og:site_name" content="怺恆のBLOG">
<meta property="og:description" content="Docker基础">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/YuJiang4319/WallPaper@master/%E9%AC%BC%E5%88%80/Dome4_4k.jpg">
<meta property="article:published_time" content="2023-08-08T11:51:38.000Z">
<meta property="article:modified_time" content="2024-01-30T07:06:37.032Z">
<meta property="article:author" content="TROUVAILLE">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/YuJiang4319/WallPaper@master/%E9%AC%BC%E5%88%80/Dome4_4k.jpg"><link rel="shortcut icon" href="https://s2.loli.net/2023/07/13/rvonATdVCpxK3wh.png"><link rel="canonical" href="http://example.com/2023/08/08/Docker/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Docker笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-01-30 15:06:37'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://cdn.jsdelivr.net/gh/YuJiang4319/WallPaper@master/%E9%AC%BC%E5%88%80/ahead1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/YuJiang4319/WallPaper@master/%E9%AC%BC%E5%88%80/Dome4_4k.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="怺恆のBLOG"><img class="site-icon" src="https://s2.loli.net/2023/07/13/rvonATdVCpxK3wh.png"/><span class="site-name">怺恆のBLOG</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Docker笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-08-08T11:51:38.000Z" title="发表于 2023-08-08 19:51:38">2023-08-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-30T07:06:37.032Z" title="更新于 2024-01-30 15:06:37">2024-01-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Docker/">Docker</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">18.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>90分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Docker笔记"><a href="#Docker笔记" class="headerlink" title="Docker笔记"></a>Docker笔记</h1><blockquote>
<p><strong>docker学习大纲</strong></p>
</blockquote>
<ul>
<li><strong>docker概述</strong></li>
<li><strong>docker安装</strong></li>
<li><strong>docker命令</strong><ul>
<li><strong>镜像命令</strong></li>
<li><strong>容器命令</strong></li>
<li><strong>操作命令</strong></li>
<li><strong>…</strong></li>
</ul>
</li>
<li><strong>docker镜像</strong></li>
<li><strong>容器数据卷</strong></li>
<li><strong>dockerfile</strong></li>
<li><strong>docker网络原理</strong></li>
<li><strong>IDEA整合docker</strong></li>
<li><strong>docker compose</strong></li>
<li><strong>docker swarm</strong></li>
</ul>
<h2 id="Docker概述"><a href="#Docker概述" class="headerlink" title="Docker概述"></a>Docker概述</h2><h3 id="docker为什么出现？"><a href="#docker为什么出现？" class="headerlink" title="docker为什么出现？"></a>docker为什么出现？</h3><p>一款产品：开发到上线，是两套环境</p>
<p>开发… 运维。问题：现在在我的电脑上可以运行，而版本更新，导致服务不可用。对于运维来说很麻烦，每个机器都要部署环境（集群Redis，ES，Hadoop）</p>
<p>所以我们希望发布一个项目时，带上所有环境打包</p>
<p>传统：开发jar，运维部署</p>
<p>现在：开发，打包，部署一套</p>
<p><img src="https://s2.loli.net/2022/04/30/KaOzn7RPAcHBfU2.png" alt="image-20220318095019373"></p>
<p>docker思想来源于集装箱</p>
<p>核心思想–隔离</p>
<h2 id="Docker历史"><a href="#Docker历史" class="headerlink" title="Docker历史"></a>Docker历史</h2><ul>
<li>2010年，几个搞IT的年轻人，就在美国成立了一家公司dotCloud，做一些 pass的云计算服务，LXC 有关的容器技术</li>
<li>他们将自己的技术 (容器化技术) 命名 就是 Docker </li>
<li>Docker 刚刚诞生的时候，没有引起行业的注意， dotCloud，就活不下去</li>
<li>2013年，Docker开源</li>
<li>Docker越来越多的人发现了docker的优点，火了，Docker每个月都会更新一个版本</li>
<li>2014年4月9日，Docker1.0发布</li>
<li>Docker为什么这么火？十分的轻巧</li>
<li>在容器技术出来之前，我们都是使用虚拟机技术</li>
<li>虚拟机：在windows中装一个Vmware，通过这个软件我们可以虚拟出来一台或者多台电脑，笨重。</li>
<li>虚拟机也是属于虚拟化技术，Docker 容器技术，也是一种 虚拟化技术</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vm ;1inux centos原生镜像（一个电脑！） 隔离，需要开启多个虚拟机！几个G几分钟</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker：隔离，镜像（最核心的环境 4m+jdk+mysq1）十分的小巧，运行镜像就可以,小巧,几个M或KB 秒级启动</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>聊聊docker</p>
</blockquote>
<p>Docker是基于Go语言开发的</p>
<p>官网：<a target="_blank" rel="noopener" href="https://www.docker.com/">https://www.docker.com/</a></p>
<p>文档：<a target="_blank" rel="noopener" href="https://docs.docker.com/">https://docs.docker.com/</a></p>
<p>Docker仓库：<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<h2 id="Docker能干嘛"><a href="#Docker能干嘛" class="headerlink" title="Docker能干嘛"></a>Docker能干嘛</h2><blockquote>
<p>之前的虚拟化技术</p>
</blockquote>
<p><img src="https://s2.loli.net/2022/04/30/I43o2x7XGBuM5qg.png" alt="image-20220318100850581"></p>
<ul>
<li>虚拟机技术缺点：<ul>
<li>资源占用多</li>
<li>冗余步骤多</li>
<li>启动慢</li>
</ul>
</li>
</ul>
<blockquote>
<p>容器化技术</p>
</blockquote>
<p><img src="https://s2.loli.net/2022/04/30/V2xIfwsm6rco9Py.png" alt="image-20220318101113843"></p>
<ul>
<li>docker和虚拟机比较<ul>
<li>传统虚拟机，虚拟出一套硬件，运行一个完整的操作系统，然后在这个系统上运行软件</li>
<li>容器内的应用直接运行在宿主机的内核上，没有自己单独的内核，也没有虚拟我们的硬件，轻便</li>
<li>每个容器间相互隔离，每个容器内都有一个自己的文件系统 ，互不影响</li>
</ul>
</li>
</ul>
<blockquote>
<p>DevOps(开发、运维)</p>
</blockquote>
<p><strong>应用更快的交付部署</strong></p>
<ul>
<li>传统运维：一堆帮助文档，安装程序</li>
<li>docker：打报镜像发布测试，一键运行</li>
</ul>
<p><strong>更便捷的升级和扩缩容</strong></p>
<ul>
<li>使用docker后，部署应用就和搭积木一样</li>
<li>项目打包为一个镜像，服务器A性能瓶颈，直接一键在服务器B上运行做负载均衡</li>
</ul>
<p><strong>更简单的系统运维</strong></p>
<ul>
<li>在容器化之后，我们的开发、测试环境都是高度一致的</li>
</ul>
<p><strong>更高效的计算资源利用</strong></p>
<ul>
<li>docker是内核级别的虚拟化，可以在一个物理机上运行很多的容器，极致压榨服务器性能</li>
</ul>
<h2 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h2><h3 id="Docker基本组成"><a href="#Docker基本组成" class="headerlink" title="Docker基本组成"></a>Docker基本组成</h3><blockquote>
<p>docker架构图</p>
</blockquote>
<p><img src="https://s2.loli.net/2022/04/30/ulEQdTp3tY6HOAR.png" alt="image-20220318102401999"></p>
<p><strong>镜像(image)：</strong></p>
<p>docker镜像就好比是一个模板，可以通过这个模板来创建容器服务，如Tomcat镜像&#x3D;》run&#x3D;》tomcat01容器(提供服务器)，通过这个镜像可以创建多个容器(最终服务或者项目就是运行在容器中)</p>
<p><strong>容器(container)：</strong></p>
<ul>
<li>docker利用容器技术，独立运行一个或者一个组应用，通过镜像来创建</li>
<li>启动、停止、删除等基本命令</li>
<li>可以理解为一个建议的Linux系统</li>
</ul>
<p><strong>仓库(repository)：</strong></p>
<ul>
<li>存放镜像的地方</li>
<li>分为私有仓库和公有仓库<ul>
<li>dockerhub、阿里云…都有容器服务器</li>
</ul>
</li>
</ul>
<h3 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h3><blockquote>
<p>环境准备</p>
</blockquote>
<ul>
<li>Linux操作基础</li>
<li>CentOS 7</li>
<li>Xshell远程连接</li>
</ul>
<blockquote>
<p>环境查看</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">系统内核3.10以上</span></span><br><span class="line">[root@Mir ~]# uname -r</span><br><span class="line">3.10.0-1160.53.1.el7.x86_64</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看系统版本</span></span><br><span class="line">[root@Mir etc]# cat /etc/os-release </span><br><span class="line">NAME=&quot;CentOS Linux&quot;</span><br><span class="line">VERSION=&quot;7 (Core)&quot;</span><br><span class="line">ID=&quot;centos&quot;</span><br><span class="line">ID_LIKE=&quot;rhel fedora&quot;</span><br><span class="line">VERSION_ID=&quot;7&quot;</span><br><span class="line">PRETTY_NAME=&quot;CentOS Linux 7 (Core)&quot;</span><br><span class="line">ANSI_COLOR=&quot;0;31&quot;</span><br><span class="line">CPE_NAME=&quot;cpe:/o:centos:centos:7&quot;</span><br><span class="line">HOME_URL=&quot;https://www.centos.org/&quot;</span><br><span class="line">BUG_REPORT_URL=&quot;https://bugs.centos.org/&quot;</span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT=&quot;CentOS-7&quot;</span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION=&quot;7&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT=&quot;centos&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION=&quot;7&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>安装</p>
</blockquote>
<p><strong>查看官方帮助文档</strong></p>
<ul>
<li><strong>卸载旧版本</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>需要的安装包</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>设置镜像仓库</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo # 默认为国外的，较慢</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">建议使用以下仓库(阿里云)</span></span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">	http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>更新yum软件包索引</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir etc]# yum makecache fast</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>安装docker</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io  # ce为社区版  ee企业版</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>启动docker</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>使用docker version查看是否安装成功</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2022/04/30/duLArDq8QiaEJfk.png" alt="image-20220318110211003"></p>
<ul>
<li><strong>测试docker引擎</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2022/04/30/1YX9oGtDpWCyTNg.png" alt="image-20220318110549899"></p>
<ul>
<li><strong>查看下载的hello-world镜像</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir etc]# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">hello-world   latest    feb5d9fea6a5   5 months ago   13.3kB</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>卸载docker</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">卸载依赖</span></span><br><span class="line">sudo yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除资源</span></span><br><span class="line">sudo rm -rf /var/lib/docker  # docker默认工作路径 </span><br><span class="line">sudo rm -rf /var/lib/containerd</span><br></pre></td></tr></table></figure>

<h3 id="阿里云镜像加速"><a href="#阿里云镜像加速" class="headerlink" title="阿里云镜像加速"></a>阿里云镜像加速</h3><ul>
<li><strong>找到容器镜像服务</strong></li>
</ul>
<p><img src="https://s2.loli.net/2022/04/30/Mtw5UmQDFJORA9g.png" alt="image-20220318111739605"></p>
<ul>
<li><strong>配置</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://sfvejie6.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>回顾hello-world流程</strong></li>
</ul>
<p><img src="https://s2.loli.net/2022/04/30/Zu4IcTLJrCQe6Vh.png" alt="image-20220318112222961"></p>
<h3 id="底层原理"><a href="#底层原理" class="headerlink" title="底层原理"></a>底层原理</h3><p><strong>docker是怎么工作的？</strong></p>
<ul>
<li>Docker是一个Client - Server结构的系统，Docker的守护进程运行在主机上，通过socket从客户端访问</li>
<li>DockerServer 接收到 Docker-Client 的指令，就会执行这个命令</li>
</ul>
<p><img src="https://s2.loli.net/2022/04/30/DG2PS78qi4FHcsO.png" alt="image-20220318112838931"></p>
<p><strong>Docker为什么比虚拟机快？</strong></p>
<ul>
<li>docker有着比虚拟机更少的抽象层</li>
<li>docker利用的是宿主机的内核，VM需要的是Guest OS</li>
</ul>
<p><img src="https://s2.loli.net/2022/04/30/3aXNtSDWhbEidmY.png" alt="image-20220318113420867"></p>
<ul>
<li>所以说，新建一个容器的时候，docker不需要想虚拟机一样重新加载一个操作系统内核，避免引导</li>
<li>虚拟机是加载Guest OS，分钟级别的，而docker 是利用 宿主机的操作系统，省略了这个复杂的过程，秒级</li>
</ul>
<h2 id="Docker常用命令"><a href="#Docker常用命令" class="headerlink" title="Docker常用命令"></a>Docker常用命令</h2><h3 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version   # 显示docker版本信息</span><br><span class="line">docker info		# 显示docker系统信息，包括镜像和容器的数量</span><br><span class="line">docker command --help		# 帮助命令</span><br></pre></td></tr></table></figure>

<ul>
<li>帮助文档地址：<a target="_blank" rel="noopener" href="https://docs.docker.com/reference/">https://docs.docker.com/reference/</a></li>
</ul>
<h3 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h3><ul>
<li><strong>docker images  查看所有本地主机上的镜像</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir etc]# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">hello-world   latest    feb5d9fea6a5   5 months ago   13.3kB</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解释</span></span><br><span class="line">REPOSITORY	镜像的仓库源</span><br><span class="line">TAG			镜像的标签</span><br><span class="line">IMAGE ID	镜像的id</span><br><span class="line">CREATED		镜像的创建时间</span><br><span class="line">SIZE		镜像的大小</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可选参数</span></span><br><span class="line">  -a, --all             # 列出所有镜像</span><br><span class="line">  -q, --quiet           # 只显示镜像的id</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>docker search 搜索镜像</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir etc]# docker search mysql</span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2022/04/30/V4tW7CLUFdYKPkq.png" alt="image-20220318121511354"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可选参数</span></span><br><span class="line">--filter=STARS=3000  # 搜索STARS大于3000的镜像</span><br><span class="line">[root@Mir etc]# docker search mysql --filter=STARS=3000</span><br><span class="line">NAME      DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">mysql     MySQL is a widely used, open-source relation…   12268     [OK]       </span><br><span class="line">mariadb   MariaDB Server is a high performing open sou…   4718      [OK] </span><br></pre></td></tr></table></figure>

<ul>
<li><strong>docker pull</strong> <strong>下载镜像</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载镜像  docker pull 镜像名[:tag]</span></span><br><span class="line">[root@Mir etc]# docker pull mysql</span><br><span class="line">Using default tag: latest   # 不加tag默认为latest最新版</span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">72a69066d2fe: Pull complete   # 分层下载，docker image的核心，联合文件系统</span><br><span class="line">93619dbc5b36: Pull complete </span><br><span class="line">99da31dd6142: Pull complete </span><br><span class="line">626033c43d70: Pull complete </span><br><span class="line">37d5d7efb64e: Pull complete </span><br><span class="line">ac563158d721: Pull complete </span><br><span class="line">d2ba16033dad: Pull complete </span><br><span class="line">688ba7d5c01a: Pull complete </span><br><span class="line">00e060b6d11d: Pull complete </span><br><span class="line">1c04857f594f: Pull complete </span><br><span class="line">4d7cfa90e6ea: Pull complete </span><br><span class="line">e0431212d27d: Pull complete </span><br><span class="line">Digest: sha256:e9027fe4d91c0153429607251656806cc784e914937271037f7738bd5b8e7709 # 签名防伪</span><br><span class="line">Status: Downloaded newer image for mysql:latest</span><br><span class="line">docker.io/library/mysql:latest   # 真实地址</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">上面命令等价于：</span></span><br><span class="line">docker pull docker.io/library/mysql:lates</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定版本下载：</span></span><br><span class="line">[root@Mir etc]# docker pull mysql:5.7</span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2022/04/30/cDSwCUt92QNuHEJ.png" alt="image-20220318122304230"></p>
<ul>
<li>上面的Already exists体现了联合文件系统的优势，检查到不同版本镜像之间有相同文件则只下载差异部分</li>
</ul>
<p><img src="https://s2.loli.net/2022/04/30/tEwyXeVHhBC3kvr.png" alt="image-20220318122647575"></p>
<ul>
<li><strong>docker rmi删除镜像</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rmi -f 容器id  # 删除指定id镜像</span><br><span class="line">docker rmi -f 容器id 容器id 容器id ...   # 删除多个镜像</span><br><span class="line">docker rmi -f $(docker images -aq)    # 删除所有镜像             </span><br></pre></td></tr></table></figure>

<h3 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h3><p><strong>说明：我们有了镜像才可以创建容器，这里我们使用centOS测试学习</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos</span><br></pre></td></tr></table></figure>

<p><strong>新建容器并启动</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run [args] iamge</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">参数说明</span></span><br><span class="line">--name=&quot;Name&quot;  	# 容器名称 如Tomcat01 Tomcat02来区分容器</span><br><span class="line">-d  			# 以后台方式运行</span><br><span class="line">-it				# 使用交互方式运行，进入容器查看内容</span><br><span class="line">-p				# 指定容器的端口  如-p 8080：8080</span><br><span class="line">	-p ip：主机端口：容器端口</span><br><span class="line">	-p 主机端口：容器端口(常用)</span><br><span class="line">	-p 容器端口</span><br><span class="line">	容器端口(直接写，不加-p)</span><br><span class="line">-P				# 随机指定端口</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动并进入容器</span></span><br><span class="line">[root@Mir etc]# docker run -it centos /bin/bash </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看容器内的centos，基础版本，很多命令不完善</span></span><br><span class="line">[root@a39748e1c63f /]# ls</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从容器中返回主机</span></span><br><span class="line">[root@a39748e1c63f /]# exit</span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span></span><br></pre></td></tr></table></figure>

<p><strong>列出所有运行中的容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir /]# docker ps    # 列出当前正在运行的容器</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">参数说明</span></span><br><span class="line">-a 		# 列出当前正在运行的容器以及历史运行过的容器</span><br><span class="line">-n=?  	# 显示最近创建的容器，可指定个数</span><br><span class="line">-q 		# 只显示容器的编号</span><br><span class="line"></span><br><span class="line">[root@Mir /]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">[root@Mir /]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE         COMMAND       CREATED         STATUS                      PORTS     NAMES</span><br><span class="line">a39748e1c63f   centos        &quot;/bin/bash&quot;   3 minutes ago   Exited (0) 31 seconds ago             focused_bose</span><br><span class="line">97988d387bed   hello-world   &quot;/hello&quot;      2 hours ago     Exited (0) 2 hours ago                objective_carver</span><br></pre></td></tr></table></figure>

<p><strong>退出容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">exit 	# 直接停止容器并退出</span><br><span class="line">Ctrl + P + Q	# 不停止容器并退出</span><br><span class="line"></span><br><span class="line">[root@Mir /]# docker run -it centos /bin/bash</span><br><span class="line">&#123;Ctrl + P + Q&#125;</span><br><span class="line">[root@Mir /]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">bd6bf8cc4c20   centos    &quot;/bin/bash&quot;   45 seconds ago   Up 44 seconds             lucid_archimedes</span><br></pre></td></tr></table></figure>

<p><strong>删除容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rm 容器id			# 删除指定容器，不能删除正在运行的容器，强制删除用rm -f</span><br><span class="line">docker rm -f $(docker ps -aq)	# 删除所有的容器</span><br><span class="line">docker ps -a -q|xargs docker rm		# 删除所有的容器</span><br></pre></td></tr></table></figure>

<p><strong>启动、停止容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start 容器id		# 启动容器</span><br><span class="line">docker restart 容器id		# 重启容器</span><br><span class="line">docker stop 容器id		# 停止当前正在运行的容器</span><br><span class="line">docker kill 容器id		# 强制停止当前容器</span><br></pre></td></tr></table></figure>

<h3 id="常用其他命令"><a href="#常用其他命令" class="headerlink" title="常用其他命令"></a>常用其他命令</h3><p><strong>后台启动容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker run -d 镜像名</span></span><br><span class="line">[root@Mir /]# docker run -d centos</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">出现问题docker ps:发现centos停止了</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这是常见的坑:docker容器使用后台运行，就必须要有一个前台进程，docker发现没有应用，就会自动停止</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如Nginx容器启动后，发现自己没有提供服务，就会立刻停止，就是没有程序了</span></span><br></pre></td></tr></table></figure>

<p><strong>查看日志</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker logs -f -t --tail n 容器id   # n是输出日志条数,f是format，t显示时间戳 </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">写一段shell脚本</span></span><br><span class="line">docker run -d centos /bin/sh -c &quot;while true;do echo kuangshen;sleep 1;done&quot;</span><br></pre></td></tr></table></figure>

<p><strong>查看容器中的进程信息</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker top 容器<span class="built_in">id</span></span></span><br><span class="line">[root@Mir /]# docker top 991ab0d4e795</span><br><span class="line">UID                 PID                 PPID                C                   STIME     </span><br><span class="line">root                27592               27572               0                   15:27     </span><br></pre></td></tr></table></figure>

<p><strong>查看镜像元数据</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker inspect 容器<span class="built_in">id</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试</span></span><br><span class="line">[root@Mir /]# docker inspect 991ab0d4e795</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;991ab0d4e795f0f806783a4f28a39a7e8ff8b096ee25508fe06ef2e199985aea&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2022-03-18T07:27:47.934060985Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/bin/bash&quot;,</span><br><span class="line">        &quot;Args&quot;: [],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 27592,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2022-03-18T07:27:48.331337114Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:5d0da3dc976460b72c77d94c8a1ad043720b0416bfc16c52c45d4847e53fadb6&quot;,</span><br><span class="line">        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/991ab0d4e795f0f806783a4f28a39a7e8ff8b096ee25508fe06ef2e199985aea/resolv.conf&quot;,</span><br><span class="line">        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/991ab0d4e795f0f806783a4f28a39a7e8ff8b096ee25508fe06ef2e199985aea/hostname&quot;,</span><br><span class="line">        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/991ab0d4e795f0f806783a4f28a39a7e8ff8b096ee25508fe06ef2e199985aea/hosts&quot;,</span><br><span class="line">        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/991ab0d4e795f0f806783a4f28a39a7e8ff8b096ee25508fe06ef2e199985aea/991ab0d4e795f0f806783a4f28a39a7e8ff8b096ee25508fe06ef2e199985aea-json.log&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;/objective_newton&quot;,</span><br><span class="line">        &quot;RestartCount&quot;: 0,</span><br><span class="line">        &quot;Driver&quot;: &quot;overlay2&quot;,</span><br><span class="line">        &quot;Platform&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;MountLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ProcessLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;AppArmorProfile&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ExecIDs&quot;: null,</span><br><span class="line">        &quot;HostConfig&quot;: &#123;</span><br><span class="line">            &quot;Binds&quot;: null,</span><br><span class="line">            &quot;ContainerIDFile&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LogConfig&quot;: &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;json-file&quot;,</span><br><span class="line">                &quot;Config&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;NetworkMode&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;PortBindings&quot;: &#123;&#125;,</span><br><span class="line">            &quot;RestartPolicy&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;no&quot;,</span><br><span class="line">                &quot;MaximumRetryCount&quot;: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;AutoRemove&quot;: false,</span><br><span class="line">            &quot;VolumeDriver&quot;: &quot;&quot;,</span><br><span class="line">            &quot;VolumesFrom&quot;: null,</span><br><span class="line">            &quot;CapAdd&quot;: null,</span><br><span class="line">            &quot;CapDrop&quot;: null,</span><br><span class="line">            &quot;CgroupnsMode&quot;: &quot;host&quot;,</span><br><span class="line">            &quot;Dns&quot;: [],</span><br><span class="line">            &quot;DnsOptions&quot;: [],</span><br><span class="line">            &quot;DnsSearch&quot;: [],</span><br><span class="line">            &quot;ExtraHosts&quot;: null,</span><br><span class="line">            &quot;GroupAdd&quot;: null,</span><br><span class="line">            &quot;IpcMode&quot;: &quot;private&quot;,</span><br><span class="line">            &quot;Cgroup&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Links&quot;: null,</span><br><span class="line">            &quot;OomScoreAdj&quot;: 0,</span><br><span class="line">            &quot;PidMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Privileged&quot;: false,</span><br><span class="line">            &quot;PublishAllPorts&quot;: false,</span><br><span class="line">            &quot;ReadonlyRootfs&quot;: false,</span><br><span class="line">            &quot;SecurityOpt&quot;: null,</span><br><span class="line">            &quot;UTSMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;UsernsMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;ShmSize&quot;: 67108864,</span><br><span class="line">            &quot;Runtime&quot;: &quot;runc&quot;,</span><br><span class="line">            &quot;ConsoleSize&quot;: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            &quot;Isolation&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpuShares&quot;: 0,</span><br><span class="line">            &quot;Memory&quot;: 0,</span><br><span class="line">            &quot;NanoCpus&quot;: 0,</span><br><span class="line">            &quot;CgroupParent&quot;: &quot;&quot;,</span><br><span class="line">            &quot;BlkioWeight&quot;: 0,</span><br><span class="line">            &quot;BlkioWeightDevice&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceReadBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceReadIOps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteIOps&quot;: null,</span><br><span class="line">            &quot;CpuPeriod&quot;: 0,</span><br><span class="line">            &quot;CpuQuota&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimePeriod&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimeRuntime&quot;: 0,</span><br><span class="line">            &quot;CpusetCpus&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpusetMems&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Devices&quot;: [],</span><br><span class="line">            &quot;DeviceCgroupRules&quot;: null,</span><br><span class="line">            &quot;DeviceRequests&quot;: null,</span><br><span class="line">            &quot;KernelMemory&quot;: 0,</span><br><span class="line">            &quot;KernelMemoryTCP&quot;: 0,</span><br><span class="line">            &quot;MemoryReservation&quot;: 0,</span><br><span class="line">            &quot;MemorySwap&quot;: 0,</span><br><span class="line">            &quot;MemorySwappiness&quot;: null,</span><br><span class="line">            &quot;OomKillDisable&quot;: false,</span><br><span class="line">            &quot;PidsLimit&quot;: null,</span><br><span class="line">            &quot;Ulimits&quot;: null,</span><br><span class="line">            &quot;CpuCount&quot;: 0,</span><br><span class="line">            &quot;CpuPercent&quot;: 0,</span><br><span class="line">            &quot;IOMaximumIOps&quot;: 0,</span><br><span class="line">            &quot;IOMaximumBandwidth&quot;: 0,</span><br><span class="line">            &quot;MaskedPaths&quot;: [</span><br><span class="line">                &quot;/proc/asound&quot;,</span><br><span class="line">                &quot;/proc/acpi&quot;,</span><br><span class="line">                &quot;/proc/kcore&quot;,</span><br><span class="line">                &quot;/proc/keys&quot;,</span><br><span class="line">                &quot;/proc/latency_stats&quot;,</span><br><span class="line">                &quot;/proc/timer_list&quot;,</span><br><span class="line">                &quot;/proc/timer_stats&quot;,</span><br><span class="line">                &quot;/proc/sched_debug&quot;,</span><br><span class="line">                &quot;/proc/scsi&quot;,</span><br><span class="line">                &quot;/sys/firmware&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ReadonlyPaths&quot;: [</span><br><span class="line">                &quot;/proc/bus&quot;,</span><br><span class="line">                &quot;/proc/fs&quot;,</span><br><span class="line">                &quot;/proc/irq&quot;,</span><br><span class="line">                &quot;/proc/sys&quot;,</span><br><span class="line">                &quot;/proc/sysrq-trigger&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/cad0d46ed7090be8999df59f077a6f200076b392eea38ed9116ae61e8415179e-init/diff:/var/lib/docker/overlay2/eed1e8983755cd5e93cc031f6f5e99e6ceffef7633ec12843746a3ce5659ef81/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/cad0d46ed7090be8999df59f077a6f200076b392eea38ed9116ae61e8415179e/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/cad0d46ed7090be8999df59f077a6f200076b392eea38ed9116ae61e8415179e/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/cad0d46ed7090be8999df59f077a6f200076b392eea38ed9116ae61e8415179e/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Mounts&quot;: [],</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;991ab0d4e795&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: true,</span><br><span class="line">            &quot;AttachStdout&quot;: true,</span><br><span class="line">            &quot;AttachStderr&quot;: true,</span><br><span class="line">            &quot;Tty&quot;: true,</span><br><span class="line">            &quot;OpenStdin&quot;: true,</span><br><span class="line">            &quot;StdinOnce&quot;: true,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/bash&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;centos&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;</span><br><span class="line">                &quot;org.label-schema.build-date&quot;: &quot;20210915&quot;,</span><br><span class="line">                &quot;org.label-schema.license&quot;: &quot;GPLv2&quot;,</span><br><span class="line">                &quot;org.label-schema.name&quot;: &quot;CentOS Base Image&quot;,</span><br><span class="line">                &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,</span><br><span class="line">                &quot;org.label-schema.vendor&quot;: &quot;CentOS&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;NetworkSettings&quot;: &#123;</span><br><span class="line">            &quot;Bridge&quot;: &quot;&quot;,</span><br><span class="line">            &quot;SandboxID&quot;: &quot;43bb1f25f964fce89a5ddb96ec138b332e04ad3b17735c3cab23b5155934430b&quot;,</span><br><span class="line">            &quot;HairpinMode&quot;: false,</span><br><span class="line">            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LinkLocalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;Ports&quot;: &#123;&#125;,</span><br><span class="line">            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/43bb1f25f964&quot;,</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;SecondaryIPv6Addresses&quot;: null,</span><br><span class="line">            &quot;EndpointID&quot;: &quot;f2440671838091a3411598d0836cb22353835c6289aac1f51e46c4b092f4bb52&quot;,</span><br><span class="line">            &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">            &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">            &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">            &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">            &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">            &quot;Networks&quot;: &#123;</span><br><span class="line">                &quot;bridge&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: null,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: null,</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;a43851655b4a108b037207aa6027242fd42d48debf90ee2a7eb6a61ab4913fe1&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: &quot;f2440671838091a3411598d0836cb22353835c6289aac1f51e46c4b092f4bb52&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">                    &quot;DriverOpts&quot;: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>进入当前正在运行的容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们通常都是以后台方式运行容器，需要进入容器修改配置</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker <span class="built_in">exec</span> -it 容器<span class="built_in">id</span> bashshell</span> </span><br><span class="line">[root@Mir /]# docker exec -it 991ab0d4e795 /bin/bash</span><br><span class="line">[root@991ab0d4e795 /]# ps -ef</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root         1     0  0 07:27 pts/0    00:00:00 /bin/bash</span><br><span class="line">root        16     0  0 07:51 pts/1    00:00:00 /bin/bash</span><br><span class="line">root        36    16  0 07:53 pts/1    00:00:00 ps -ef</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">方式二</span></span><br><span class="line">[root@Mir /]# docker attach 991ab0d4e795</span><br><span class="line">正在执行的代码...</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker <span class="built_in">exec</span>    进入容器后开启一个新的终端，可以在里面操作(常用)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker attach  进入容器正在执行的终端，不会启动新的进程</span></span><br></pre></td></tr></table></figure>

<p><strong>从容器内拷贝文件到主机上</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker <span class="built_in">cp</span> 容器<span class="built_in">id</span>:容器内路径 目的主机路径</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝是一个手动过程，未来我们使用 -v 卷的技术也可以实现</span></span><br></pre></td></tr></table></figure>

<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p><img src="https://s2.loli.net/2022/04/30/7mTA4Z5ycRPD9UW.png" alt="image-20220318163915470"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">attach    	# 当前shell下attach连接指定运行镜像</span><br><span class="line">build     	# 通过Dockerfile定制镜像</span><br><span class="line">commit    	# 提交当前容器为新的镜像</span><br><span class="line">cp        	# 从容器中拷贝指定文件或目录到宿主机中</span><br><span class="line">create    	# 创建一个新的容器，同 run 但不启动容器</span><br><span class="line">diff      	# 查看 docker 容器变化</span><br><span class="line">events    	# 从docker服务器获取容器实时事件</span><br><span class="line">exec      	# 在已存在的容器上运行命令</span><br><span class="line">export    	# 导出容器的内容流作为一个 tar 归档文件【对应 import】</span><br><span class="line">history   	# 展示一个镜像形成历史</span><br><span class="line">images    	# 列出系统当前镜像</span><br><span class="line">import    	# 从tar包中的内容创建一个新的文件系统映像【对应 export】</span><br><span class="line">info      	# 显示系统相关信息</span><br><span class="line">inspect   	# 查看容器详细信息</span><br><span class="line">kill      	# kill 指定的容器</span><br><span class="line">load      	# 从一个 tar 包中加载一个镜像【对应 save】</span><br><span class="line">login     	# 注册或者登录一个 docker 源服务器</span><br><span class="line">logout    	# 从当前 Docekr registry 退出</span><br><span class="line">logs      	# 输出当前容器日志信息</span><br><span class="line">port 		# 查看映射端口对应的容器内部源端</span><br><span class="line">pause		# 暂停容器</span><br><span class="line">ps			# 列出容器列表</span><br><span class="line">pu11		# 从docker镜像源服务器拉取指定镜像或者库镜像</span><br><span class="line">push		# 推送指定镜像或者库镜像至docker源服务器</span><br><span class="line">restart		# 重启运行的容器</span><br><span class="line">rm			# 移除一个或者多个容器</span><br><span class="line">rmi			# 移除一个或多个镜像[无容器使用该镜像才可删除，否则需删除相关容器才能继续-f强制删除</span><br><span class="line">run			# 创建一个新的容器并运行一个命令</span><br><span class="line">save		# 保存一个镜像为一个 tar 包[对应 1oad]</span><br><span class="line">search		# 在 docker hub 中搜索镜像</span><br><span class="line">start		# 启动容器</span><br><span class="line">stop		# 停止容器</span><br><span class="line">tag			# 给源中镜像打标签</span><br><span class="line">top			# 查看容器中运行的进程信息</span><br><span class="line">unpause		# 取消暂停容器</span><br><span class="line">version		# 查看 docker 版本号</span><br><span class="line">wait 		# 截取容器停止时的退出状态值</span><br></pre></td></tr></table></figure>

<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><blockquote>
<p>Docker安装Nginx</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、搜索镜像 search  建议去dockerhub搜索，可以查看帮助文档</span></span><br><span class="line">[root@Mir /]# docker search nginx</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、下载镜像 pull</span></span><br><span class="line">[root@Mir /]# docker pull nginx</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3、运行测试</span></span><br><span class="line">[root@Mir /]# docker run -d --name nginx01 -p 3344:80 nginx</span><br><span class="line">[root@Mir /]# curl localhost:3344</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">html &#123; color-scheme: light dark; &#125;</span><br><span class="line">body &#123; width: 35em; margin: 0 auto;</span><br><span class="line">font-family: Tahoma, Verdana, Arial, sans-serif; &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4、进入容器</span></span><br><span class="line">[root@Mir /]# docker exec -it 5a9bb2449cbe /bin/bash </span><br><span class="line">root@5a9bb2449cbe:/# ls</span><br><span class="line">bin   dev		   docker-entrypoint.sh  home  lib64  mnt  proc  run   srv  tmp  var</span><br><span class="line">boot  docker-entrypoint.d  etc			 lib   media  opt  root  sbin  sys  usr</span><br><span class="line"></span><br><span class="line">root@5a9bb2449cbe:/# whereis nginx</span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx</span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2022/04/30/vptoX6q2mxCiYOZ.png" alt="image-20220318165438298"></p>
<p><strong>思考</strong>：</p>
<ul>
<li>我们每次改动nginx配置文件，都需要进入容器内部，十分的麻烦，如果能在容器外部提供一个映射路径，达到在容器外部修改文件名，容器内部就可以自动修改？      &#x3D;&#x3D;》-v 数据卷技术</li>
</ul>
<blockquote>
<p>Tomcat部署</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">官方使用命令</span></span><br><span class="line">docker run --rm tomcat:9.0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">之前-d是后台启动，停止了容器之后，容器不会被删除   docker run --<span class="built_in">rm</span>,一般用来测试，用完关闭即自动删除</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这里使用正常下载并启动</span></span><br><span class="line">[root@Mir /]# docker pull tomcat</span><br><span class="line">[root@Mir /]# docker run -d --name tomcat01 -p 3355:8080 tomcat</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试访问没有问题</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入容器</span></span><br><span class="line">[root@Mir /]# docker exec -it tomcat01 /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现问题：1.Linux命令少了  2.没有webapps，阿里云镜像的原因，默认是最小的镜像，所有不必要的都剔除掉</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">仅保证最小可运行环境</span></span><br></pre></td></tr></table></figure>

<p><strong>思考：</strong></p>
<ul>
<li>以后要部署项目，如果每次都要进入容器十分麻烦，希望在容器外部提供一个映射路径，webapps，我们在外部部署项目，然后自动同步到内部就好了</li>
</ul>
<h2 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h2><ul>
<li><p>portainer(暂时先使用)</p>
</li>
<li><p>Rancher(CI&#x2F;CD再用)</p>
</li>
</ul>
<p><strong>什么是portainer？</strong></p>
<ul>
<li>Docker图形化管理工具，提供一个后台面板供我们操作</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装并运行</span></span><br><span class="line">[root@Mir /]# docker run -d -p 8088:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</span><br><span class="line">Unable to find image &#x27;portainer/portainer:latest&#x27; locally</span><br><span class="line">latest: Pulling from portainer/portainer</span><br><span class="line">94cfa856b2b1: Pull complete </span><br><span class="line">49d59ee0881a: Pull complete </span><br><span class="line">a2300fd28637: Pull complete </span><br><span class="line">Digest: sha256:fb45b43738646048a0a0cc74fcee2865b69efde857e710126084ee5de9be0f3f</span><br><span class="line">Status: Downloaded newer image for portainer/portainer:latest</span><br><span class="line">084ecedcd13e4a2132110794e44f37a07c25303545d5dc8a443c7d5a9cbcf04c</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>访问测试:<a target="_blank" rel="noopener" href="http://47.99.154.107:8088/">http://47.99.154.107:8088/</a></li>
</ul>
<p><img src="https://s2.loli.net/2022/04/30/hxReradGjy5lKUQ.png" alt="image-20220318225405341"></p>
<ul>
<li><strong>选择本地</strong></li>
</ul>
<p><img src="https://s2.loli.net/2022/04/30/4niS39JxUAqLC2Q.png" alt="image-20220318225442487"></p>
<ul>
<li><strong>进入之后的面板</strong></li>
</ul>
<p><img src="https://s2.loli.net/2022/04/30/7oSrcnHgVFOCQiz.png" alt="image-20220318225626995"></p>
<p><strong>平时一般不使用可视化面板，可测试玩玩</strong></p>
<h2 id="Docker镜像讲解"><a href="#Docker镜像讲解" class="headerlink" title="Docker镜像讲解"></a>Docker镜像讲解</h2><h3 id="镜像是什么？"><a href="#镜像是什么？" class="headerlink" title="镜像是什么？"></a>镜像是什么？</h3><ul>
<li>镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，包括代码、运行时库、环境变量和配置文件。</li>
<li>所有的应用，直接打包docker镜像，就可以直接跑起来！</li>
<li><strong>如何得到镜像：</strong><ul>
<li>从远程仓库下载</li>
<li>朋友拷贝给你</li>
<li>自己制作一个镜像 DockerFile</li>
</ul>
</li>
</ul>
<h3 id="Docker镜像加载原理"><a href="#Docker镜像加载原理" class="headerlink" title="Docker镜像加载原理"></a>Docker镜像加载原理</h3><blockquote>
<p>UnionFS (联合文件系统)</p>
</blockquote>
<p><strong>我们下载镜像的时候看到的就是这个，类似于Git多次提交修改叠加</strong></p>
<ul>
<li><p><strong>UnionFS（联合文件系统）</strong>：Union文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下(unite several directories into a single virtualfilesystem)。Union 文件系统是 Docker 镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像）,可以制作各种具体的应用镜像。</p>
</li>
<li><p><strong>特性</strong>：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统聋加起来，这样最终的文件系统会包含所有底层的文件和目录</p>
</li>
</ul>
<blockquote>
<p>Docker镜像加载原理</p>
</blockquote>
<ul>
<li><p>docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。</p>
</li>
<li><p>**bootfs(boot file system)**主要包含bootloader和kernel，bootloader主要是引导加载kernel，Linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层是bootfs。这一层与我们典型的Linux&#x2F;Unix系统是一样的, 包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由bootfs转交给内核，此时系统也会卸载bootfs。</p>
</li>
<li><p><strong>rootfs(root file system)</strong>, 在bootfs之上。包含的就是典型Linux系统中的&#x2F;dev, &#x2F;proc, &#x2F;bin, &#x2F;etc等标准目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu，Centos等等。<br><img src="https://s2.loli.net/2022/04/30/Ih8yrHcfNs6BRjO.png" alt="image-20220318231319979"></p>
</li>
</ul>
<p><strong>平时我们安装进虚拟机的centos都是好几个G，为什么docker这里才200M？</strong></p>
<p><img src="https://s2.loli.net/2022/04/30/Dpg6xjHtZrWEwms.png" alt="image-20220318231644581"></p>
<ul>
<li>对于一个精简的OS，rootfs 可以很小，只需要包含最基本的命令，工具和程序库就可以了，因为底层直接用Host的kernel，自己只需要提供rootfs就可以了。由此可见对于不同的linux发行版, bootfs基本是一致的, rootfs会有差别,因此不同的发行版可以公用bootfs。</li>
</ul>
<h3 id="分层理解"><a href="#分层理解" class="headerlink" title="分层理解"></a>分层理解</h3><blockquote>
<p>分层的镜像</p>
</blockquote>
<ul>
<li>我们可以去下载一个镜像，注意观察下载的日志输出，可以看到是一层一层在下载</li>
</ul>
<p><img src="https://s2.loli.net/2022/04/30/cNHdti2URbJxKYM.png" alt="image-20220318232056267"></p>
<ul>
<li><strong>思考：为什么Docker镜像要采用这种分层的结构呢？</strong><ul>
<li>最大的好处，我觉得莫过于是资源共享了！比如有多个镜像都从相同的Base镜像构建而来，那么宿主机只需在磁盘上保留一份base镜像，同时内存中也只需要加载一份base镜像，这样就可以为所有的容器服务了，而且镜像的每一层都可以被共享。</li>
<li>查看镜像分层的方式可以通过 docker image inspect 命令！</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir /]# docker image inspect redis:latest</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;sha256:7614ae9453d1d87e740a2056257a6de7135c84037c367e1fffa92ae922784631&quot;,</span><br><span class="line">        &quot;RepoTags&quot;: [</span><br><span class="line">            &quot;redis:latest&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;RepoDigests&quot;: [</span><br><span class="line">            &quot;redis@sha256:db485f2e245b5b3329fdc7eff4eb00f913e09d8feb9ca720788059fdc2ed8339&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;Parent&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Comment&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-12-21T12:42:49.755107412Z&quot;,</span><br><span class="line">        &quot;Container&quot;: &quot;13d25f53410417c5220c8dfe8bd49f06abdbcd69faa62a9b877de02464bb04a3&quot;,</span><br><span class="line">        &quot;ContainerConfig&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;13d25f534104&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;ExposedPorts&quot;: &#123;</span><br><span class="line">                &quot;6379/tcp&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,</span><br><span class="line">                &quot;GOSU_VERSION=1.12&quot;,</span><br><span class="line">                &quot;REDIS_VERSION=6.2.6&quot;,</span><br><span class="line">                &quot;REDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-6.2.6.tar.gz&quot;,</span><br><span class="line">                &quot;REDIS_DOWNLOAD_SHA=5b2b8b7a50111ef395bf1c1d5be11e6e167ac018125055daa8b5c2317ae131ab&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/sh&quot;,</span><br><span class="line">                &quot;-c&quot;,</span><br><span class="line">                &quot;#(nop) &quot;,</span><br><span class="line">                &quot;CMD [\&quot;redis-server\&quot;]&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;sha256:e093f59d716c95cfce82c676f099b960cc700432ab531388fcedf79932fc81ec&quot;,</span><br><span class="line">            &quot;Volumes&quot;: &#123;</span><br><span class="line">                &quot;/data&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;/data&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: [</span><br><span class="line">                &quot;docker-entrypoint.sh&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;DockerVersion&quot;: &quot;20.10.7&quot;,</span><br><span class="line">        &quot;Author&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;ExposedPorts&quot;: &#123;</span><br><span class="line">                &quot;6379/tcp&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,</span><br><span class="line">                &quot;GOSU_VERSION=1.12&quot;,</span><br><span class="line">                &quot;REDIS_VERSION=6.2.6&quot;,</span><br><span class="line">                &quot;REDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-6.2.6.tar.gz&quot;,</span><br><span class="line">                &quot;REDIS_DOWNLOAD_SHA=5b2b8b7a50111ef395bf1c1d5be11e6e167ac018125055daa8b5c2317ae131ab&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;redis-server&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;sha256:e093f59d716c95cfce82c676f099b960cc700432ab531388fcedf79932fc81ec&quot;,</span><br><span class="line">            &quot;Volumes&quot;: &#123;</span><br><span class="line">                &quot;/data&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;/data&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: [</span><br><span class="line">                &quot;docker-entrypoint.sh&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: null</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Architecture&quot;: &quot;amd64&quot;,</span><br><span class="line">        &quot;Os&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;Size&quot;: 112691373,</span><br><span class="line">        &quot;VirtualSize&quot;: 112691373,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/c95a095ab39e35a4837e2a625227eef89ef057982a22bf40d8934bf151a7bc43/diff:/var/lib/docker/overlay2/a3f0b0dc2b2706224d8e041bf8e31ebc91ba10de042c48ccd57c41f4917c62a3/diff:/var/lib/docker/overlay2/0c1b85389227627a6c7c6a2c74b8ff98c8ca6965db91e91cf502917201c9ae45/diff:/var/lib/docker/overlay2/f0ecefb9dba28e06368057b36ff93de24ad1ce589967e0b807fe0e36d62145bc/diff:/var/lib/docker/overlay2/39f95bbd9ff98228453939b1b11c068ccaf7d7a4729da1dbb7aaa5848f1235cc/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/734558b15eb12ff3e826efd65acc62c388776d822917d4ee275e99b26fe044ef/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/734558b15eb12ff3e826efd65acc62c388776d822917d4ee275e99b26fe044ef/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/734558b15eb12ff3e826efd65acc62c388776d822917d4ee275e99b26fe044ef/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;RootFS&quot;: &#123;</span><br><span class="line">            &quot;Type&quot;: &quot;layers&quot;,</span><br><span class="line">            &quot;Layers&quot;: [</span><br><span class="line">                &quot;sha256:2edcec3590a4ec7f40cf0743c15d78fb39d8326bc029073b41ef9727da6c851f&quot;,</span><br><span class="line">                &quot;sha256:9b24afeb7c2f21e50a686ead025823cd2c6e9730c013ca77ad5f115c079b57cb&quot;,</span><br><span class="line">                &quot;sha256:4b8e2801e0f956a4220c32e2c8b0a590e6f9bd2420ec65453685246b82766ea1&quot;,</span><br><span class="line">                &quot;sha256:529cdb636f61e95ab91a62a51526a84fd7314d6aab0d414040796150b4522372&quot;,</span><br><span class="line">                &quot;sha256:9975392591f2777d6bf4d9919ad1b2c9afa12f9a9b4d260f45025ec3cc9b18ed&quot;,</span><br><span class="line">                &quot;sha256:8e5669d8329116b8444b9bbb1663dda568ede12d3dbcce950199b582f6e94952&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Metadata&quot;: &#123;</span><br><span class="line">            &quot;LastTagTime&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>理解</strong></p>
<ul>
<li>所有的 Docker 镜像都起始于一个基础镜像层，当进行修改或增加新的内容时，就会在当前镜像层之上，创建新的镜像层。</li>
<li>举一个简单的例子，假如基于 Ubuntu Linux 16.04 创建一个新的镜像，这就是新镜像的第一层；如果在该镜像中添加 Python包，就会在基础镜像层之上创建第二个镜像层；如果继续添加一个安全补丁，就会创建第三个镜像层。</li>
<li>该镜像当前已经包含 3 个镜像层，如下图所示（这只是一个用于演示的很简单的例子）。</li>
</ul>
<p><img src="https://s2.loli.net/2022/04/30/SyfdM8ctTmxEohA.png" alt="image-20220318232632278"></p>
<ul>
<li>在添加额外的镜像层的同时，镜像始终保持是当前所有镜像的组合，这一点很重要。下图中举了一个简单的例子，每个镜像层包含 3个文件，而镜像包含了来自两个镜像层的 6 个文件。</li>
</ul>
<p><img src="https://s2.loli.net/2022/04/30/3NDLSw84o6zqY5K.png" alt="image-20220318232835807"></p>
<ul>
<li>上图中的镜像层跟之前图中的略有区别，主要目的是便于展示文件。</li>
<li>下图中展示了一个稍微复杂的三层镜像，在外部看来整个镜像只有6个文件，这是因为最上层中的文件7是文件5的一个更新版本。</li>
</ul>
<p><img src="https://s2.loli.net/2022/04/30/OYw96Chpy7iW1F4.png" alt="image-20220318233031758"></p>
<ul>
<li>这种情况下，上层镜像层中的文件覆盖了底层镜像层中的文件。这样就使得文件的更新版本作为一个新镜像层添加到镜像当中。</li>
<li>Docker 通过存储引擎（新版本采用快照机制）的方式来实现镜像层堆栈，并保证多镜像层对外展示为统一的文件系统。</li>
<li>Linux 上可用的存储引擎有AUFS、Overlay2、Device Mapper、Btrfs以及ZFS。顾名思义，每种存储引擎都基于 Linux 中对应的文件系统或者块设备技术，并且每种存储引擎都有其独有的性能特点。</li>
<li>Docker在Windows 上仅支持windowsfilter一种存储引擎，该引擎基于NTFS文件系统之上实现了分层和CoW。</li>
<li>下图展示了与系统显示相同的三层镜像。所有镜像层堆叠并合并，对外提供统一的视图。</li>
</ul>
<p><img src="https://s2.loli.net/2022/04/30/A8x64ZaXNRPQYDO.png" alt="image-20220318233248263"></p>
<blockquote>
<p>特点</p>
</blockquote>
<ul>
<li>Docker镜像都是只读的，当容器启动时，一个新的可写层被加载到镜像顶部</li>
<li>这一层就是我们通常说的容器层，容器之下的都叫镜像层</li>
</ul>
<p><img src="https://s2.loli.net/2022/04/30/xS9lPQTZWBvsdU8.png" alt="image-20220318233806301"></p>
<ul>
<li>可以将操作后的容器层和原本的镜像层重新打包为新的镜像</li>
</ul>
<h3 id="Commit镜像"><a href="#Commit镜像" class="headerlink" title="Commit镜像"></a>Commit镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker commit   提交容器成为一个新的副本</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">命令和git原理相似</span></span><br><span class="line">docker commit -m=&quot;提交的描述信息&quot; -a=&quot;作者&quot; 容器id 目标镜像名:[TAG]</span><br></pre></td></tr></table></figure>

<p><strong>实战测试：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1.启动一个官网下载的默认Tomcat</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2.发现这个默认的Tomcat的webapps文件夹为空，官方默认没有文件</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">3.自己手动添加基本的文件(容器层操作)</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">4.将我们操作过的容器通过commit提交为一个镜像，以后可以直接通过该镜像启动容器，这就是我们修改过的镜像</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/P53bFMpQqyzTW1V.png"></p>
<blockquote>
<p>可见提交后镜像文件变大</p>
<p>因此我们可以通过commit保存当前容器的状态，类似于VMware的快照</p>
</blockquote>
<h2 id="容器数据卷"><a href="#容器数据卷" class="headerlink" title="容器数据卷"></a>容器数据卷</h2><h3 id="什么是容器数据卷？"><a href="#什么是容器数据卷？" class="headerlink" title="什么是容器数据卷？"></a>什么是容器数据卷？</h3><p><strong>docker的理念回顾</strong><br>将应用和环境打包成一个镜像！<br>数据？如果数据都在容器中，那么我们容器删除，数据就会丢失！ 需求：数据可以持久化<br>MySQL,容器删了，删库跑路！  需求：MySQL数据可以存储在本地！<br>容器之间可以有一个数据共享的技术！Docker容器中产生的数据，同步到本地！<br>这就是卷技术！目录的挂载，将我们容器内的目录，挂载到Liux上面！</p>
<p><img src="https://s2.loli.net/2022/04/30/5FT7k4O9NtEaRC1.png" alt="image-20220427125439497"></p>
<p><strong>总结：容器的持久化和同步操作，同时容器间可以绑定到同一个目录，实现数据共享</strong></p>
<h3 id="使用数据卷："><a href="#使用数据卷：" class="headerlink" title="使用数据卷："></a>使用数据卷：</h3><blockquote>
<p>方式一：直接使用命令来挂载  -v    （volume）</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v 主机目录:容器内目录</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试</span></span><br><span class="line">[root@Mir home]# docker run -it -v /home/test:/home centos /bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动容器后可通过inspect查看容器信息    Mounts挂载</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2022/04/30/Iu7QxwFUpXA6EGK.png" alt="image-20220427130417813">、</p>
<blockquote>
<p> <strong>测试文件同步</strong></p>
</blockquote>
<p><img src="https://s2.loli.net/2022/04/30/28Dnqh1xuOv9glN.png" alt="image-20220427130839573"></p>
<blockquote>
<p>停止容器后，在宿主机修改文件，再启动容器，文件仍然同步</p>
</blockquote>
<p><img src="https://s2.loli.net/2022/04/30/Jv2fFUMu1CjhSXs.png" alt="image-20220427131220454"></p>
<p><strong>总结：以后只需在本地修改即可同步到容器</strong></p>
<h3 id="实战：安装MySQL"><a href="#实战：安装MySQL" class="headerlink" title="实战：安装MySQL"></a>实战：安装MySQL</h3><p>思考：mysql容器如何将数据持久化存储，不能因为删除容器而导致数据丢失</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取镜像</span></span><br><span class="line">[root@Mir home]# docker pull mysql:5.7</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行容器，需要做数据挂载</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装启动mysql，需要注意配置密码</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">官方命令：docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动mysql</span></span><br><span class="line">-d 后台运行</span><br><span class="line">-p 端口映射</span><br><span class="line">-v 数据卷挂载</span><br><span class="line">-e 环境配置(此处为配置密码)</span><br><span class="line">--name 容器名字</span><br><span class="line">[root@Mir home]# docker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动成功之后，可通过sqlyog连接到服务器的3310端口，即容器内的3306端口</span></span><br></pre></td></tr></table></figure>

<p><strong>假设将容器删除，挂载到本地的数据卷依旧没有消失，实现了容器数据持久化存储功能</strong></p>
<h3 id="具名和匿名挂载"><a href="#具名和匿名挂载" class="headerlink" title="具名和匿名挂载"></a>具名和匿名挂载</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">匿名挂载</span></span><br><span class="line">直接：-v 容器内路径</span><br><span class="line">docker run -d -P --name nginx01 -v /etc/nginx nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看所有volume的情况</span></span><br><span class="line">[root@Mir home]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     8da5f07b8cb1cfb14c8124434cf1fda9550abcfeefa6364973ecc179ccd3dd0e</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这种就为匿名挂载，-v只写了容器内路径，没有指定主机路径</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">具名挂载</span></span><br><span class="line">-v 卷名：容器内路径</span><br><span class="line">[root@Mir home]# docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx nginx</span><br><span class="line">bcc051750aa3b1cda0a6d7a442ba0d815824509e6f7c8da8e660650198f33869</span><br><span class="line">[root@Mir home]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     8da5f07b8cb1cfb14c8124434cf1fda9550abcfeefa6364973ecc179ccd3dd0e</span><br><span class="line">local     juming-nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看卷详细信息</span></span><br><span class="line">[root@Mir home]# docker volume inspect juming-nginx</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2022-04-27T15:13:17+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: null,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/juming-nginx/_data&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;juming-nginx&quot;,</span><br><span class="line">        &quot;Options&quot;: null,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">其中Mountpoint字段即为该卷的主机路径</span></span><br></pre></td></tr></table></figure>

<p><strong>所有的docker容器卷在没有指定主机路径的情况下都是在  &#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;xxx&#x2F;_data</strong></p>
<p><strong>通过具名挂载可以方便的找到我们存储的卷，建议使用具名挂载</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如何确定是具名挂载，匿名挂载，还是指定路径挂载</span></span><br><span class="line">-v 容器内路径  # 匿名挂载</span><br><span class="line">-v 卷名：容器内路径  # 具名挂载</span><br><span class="line">-v 主机路径：容器路径   # 指定路径挂载	</span><br></pre></td></tr></table></figure>

<p><strong>拓展</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过-v 容器内路径:ro或者rw 改变读写权限</span></span><br><span class="line">ro  readonly   # 只读（指只能主机修改，容器内不能修改）</span><br><span class="line">rw  readwrite  # 可读写</span><br><span class="line"></span><br><span class="line">docker run -d -P --name nginx01 -v juming-nginx01:/etc/nginx:ro nginx</span><br><span class="line">docker run -d -P --name nginx02 -v juming-nginx02:/etc/nginx:rw nginx</span><br></pre></td></tr></table></figure>

<h3 id="初识DockerFile"><a href="#初识DockerFile" class="headerlink" title="初识DockerFile"></a>初识DockerFile</h3><blockquote>
<p>方式二：</p>
</blockquote>
<p><strong>dockerfile就是用来构建docker镜像的构建文件，命令脚本</strong></p>
<p><strong>通过这个脚本可以生成镜像，每一行命令就相当于镜像的一层</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建一个dockerfile文件，名字可以随机，建议Dockerfile</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">文件中的内容：指令（大写） 参数</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2022/04/30/8pemOVWoZIkazu9.png" alt="image-20220427160623309"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir docker_test_volume]# docker build -f /home/docker_test_volume/dockerfile -t yyj_centos:1.0 .</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/4 : FROM centos</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">5d0da3dc9764</span></span><br><span class="line">Step 2/4 : VOLUME [&quot;volume01&quot;,&quot;volume02&quot;]</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 44ce08c4f383</span></span><br><span class="line">Removing intermediate container 44ce08c4f383</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">03d329965265</span></span><br><span class="line">Step 3/4 : CMD echo &quot;---end---&quot;</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> d6aa40397acd</span></span><br><span class="line">Removing intermediate container d6aa40397acd</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">316ac9d6f1e1</span></span><br><span class="line">Step 4/4 : CMD /bin/bash</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 4f5633291a96</span></span><br><span class="line">Removing intermediate container 4f5633291a96</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">d354ecc1bde3</span></span><br><span class="line">Successfully built d354ecc1bde3</span><br><span class="line">Successfully tagged yyj_centos:1.0</span><br><span class="line"></span><br><span class="line">[root@Mir docker_test_volume]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">yyj_centos            1.0       d354ecc1bde3   38 seconds ago   231MB</span><br></pre></td></tr></table></figure>

<p><strong>启动自己构建的镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir docker_test_volume]# docker run -it yyj_centos:1.0 /bin/bash</span><br><span class="line">[root@9abd97510d87 /]# ls</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var  volume01	volume02</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">后两个目录就是我们生成镜像的时候自动挂载的数据卷目录</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">由于未指定路径以及卷名，所以为匿名挂载，位于主机的默认路径下</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2022/04/30/oCuvw3Zyedx6zF2.png" alt="image-20220427161303025"></p>
<p><strong>这种方式较为常用，通常会自己构建镜像</strong></p>
<p><strong>假设构建镜像时没有挂载卷，则需要手动挂载</strong></p>
<h3 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h3><p><strong>实现多MySQL同步数据</strong></p>
<p><img src="https://s2.loli.net/2022/04/30/otghcKeb2TCiYQJ.png" alt="image-20220427170935792"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过刚刚自己构建的镜像启动3个容器</span></span><br><span class="line">[root@Mir ~]# docker run -it -P --name docker01 yyj_centos:1.0 /bin/bash </span><br><span class="line">[root@Mir ~]# docker run -it --name docker02 --volumes-from docker01 yyj_centos:1.0 /bin/bash</span><br><span class="line">[root@Mir ~]# docker run -it --name docker03 --volumes-from docker01 yyj_centos:1.0 /bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试：docker01，docker02，docker03数据同步，之间相当于拷贝的概念，即使停止或删除docker01（父容器），docker02与docker03的数据依旧不会消失</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2022/04/30/86AZHTezgpRvysS.png" alt="image-20220428082957978"></p>
<p><strong>总结：类似根域名服务器与镜像服务器的关系</strong></p>
<blockquote>
<p>实战：多个MySQL实现数据共享</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir home]# docker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line"></span><br><span class="line">[root@Mir home]# docker run -d -p 3310:3306 -e MYSQL_ROOT_PASSWORD=123456 --name mysql02 --volumes-from mysql01 mysql:5.7</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这个时候就可以实现mysql01与mysql02数据的同步</span> </span><br></pre></td></tr></table></figure>

<p><strong>结论：容器之间配置信息的传递，数据卷的生命周期一直持续到没有容器使用为止，但是一旦持久化存储到本地，即-v，则本地数据不会受影响</strong></p>
<h3 id="DcockerFile"><a href="#DcockerFile" class="headerlink" title="DcockerFile"></a>DcockerFile</h3><p>dockerfile是用来构建docker镜像的文件，命令参数脚本</p>
<p>构建步骤:</p>
<ul>
<li><p>编写一个dockerfile文件</p>
</li>
<li><p>docker build 构建成为一个镜像</p>
</li>
<li><p>docker run 运行镜像</p>
</li>
<li><p>docker push 发布镜像（DockerHub，阿里云镜像仓库）</p>
</li>
</ul>
<p><strong>查看官方命令</strong></p>
<p><img src="https://s2.loli.net/2022/04/30/Rgrw6U1XavqHb5K.png" alt="image-20220428084836666"></p>
<p><strong>选择一个版本进入</strong></p>
<p><img src="https://s2.loli.net/2022/04/30/YRfnuxJVG92XsWw.png" alt="image-20220428085000490"></p>
<p>很多官方镜像都是基础包，缺少很多功能，通常需要自己构建</p>
<h3 id="DockerFile构建过程"><a href="#DockerFile构建过程" class="headerlink" title="DockerFile构建过程"></a>DockerFile构建过程</h3><p><strong>基础知识：</strong></p>
<ul>
<li>每个保留关键字（指令）都必须是大写字母</li>
<li>自上而下执行</li>
<li>#表示注释</li>
<li>每个指令都会创建提交一个新的镜像层</li>
</ul>
<img src="https://s2.loli.net/2022/04/30/qd8ZuaibAVF2nXw.png" alt="image-20220428085705214" style="zoom:50%;" />

<ul>
<li><p>DockerFile是面向开发的，以后要发布项目，做镜像，就需要编写dockerfile文件</p>
</li>
<li><p>Docker镜像逐渐成为企业交付的标准，很重要</p>
</li>
<li><p>DockerFile：构建文件，定义了构建的步骤，源代码</p>
</li>
<li><p>DockerImages：通过DockerFile构建生成的容器，最终发布和运行的产品</p>
</li>
<li><p>Docker容器：运行镜像的服务器</p>
</li>
</ul>
<h3 id="DockerFile-的指令"><a href="#DockerFile-的指令" class="headerlink" title="DockerFile 的指令"></a>DockerFile 的指令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM       	# 基础镜像，一切从这里开始构建</span><br><span class="line">MAINTAINER	# 镜像是谁写的，姓名+邮箱</span><br><span class="line">RUN			# 镜像构建时需要运行的命令</span><br><span class="line">ADD			# 添加内容，如Nginx，Tomcat</span><br><span class="line">WORKDIR		# 镜像的工作目录</span><br><span class="line">VOLUME		# 挂载的目录</span><br><span class="line">EXPOSE		# 暴露端口配置，运行时不再需要指定端口</span><br><span class="line">CMD			# 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代</span><br><span class="line">ENTRYPOINT  # 指定这个容器启动的时候要运行的命令，可以追加命令</span><br><span class="line">ONBUILD		# 当构建一个被继承DockerFile这个时候就会运行ONBUILD的指令（触发指令）</span><br><span class="line">COPY		# 类似ADD，将文件拷贝到镜像中</span><br><span class="line">ENV			# 构建的时候设置环境变量（如mysql设置用户名密码）</span><br></pre></td></tr></table></figure>



<img src="https://s2.loli.net/2022/04/30/KurdhzO25PCpZDE.png" alt="image-20220428090330965" style="zoom: 67%;" />

<h3 id="实战测试"><a href="#实战测试" class="headerlink" title="实战测试"></a>实战测试</h3><p><strong>DockerHub中绝大多数镜像都是从这个基础镜像开始构建的（FROM scratch），然后配置需要的软件</strong></p>
<p><img src="https://s2.loli.net/2022/04/30/YRfnuxJVG92XsWw.png" alt="image-20220428085000490"></p>
<blockquote>
<p>创建一个自己的centOS</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">构建命令</span></span><br><span class="line">docker build -f dockerfile文件路径 -t 镜像命名：[tag] .</span><br></pre></td></tr></table></figure>

<p><strong>关于命令末尾的点号：</strong></p>
<p>在官方文档的Dockerfile reference的章节中有以下重点内容:</p>
<ul>
<li>生成过程的第一件事是将整个文件构建镜像上下文（递归）发送到守护进程。</li>
<li>ps:不要使用根目录 ，因为它会将硬盘驱动器的全部内容传输到 Docker 守护进程。</li>
<li>一个个指令是在Docker守护进程中运行,然后将每个指令的结果提交到新镜像,最终输出新镜像的ID，Docker守护进程会自动清理发送的构建镜像上下文。”</li>
</ul>
<p><img src="https://s2.loli.net/2022/04/30/IhKbyfdSVPxE8rj.png" alt="asdfsf"></p>
<p><img src="https://s2.loli.net/2022/04/30/mtc2alX5yRU7oAh.png" alt="gsdg"></p>
<ul>
<li>通过上述内容可以大致知道 镜像的构建是在Docker引擎(Docker守护进程)中完成的，在执行docker build命令后,本机会将Dockerfile文件所在路径下的所有文件打包上传给Docker引擎,由Docker引擎完成镜像的构建。</li>
</ul>
<p><strong>结论:点号是指镜像构建时打包上传到Docker引擎中的文件的目录,而不是本机目录</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编写dockerfile文件</span></span><br><span class="line">[root@Mir my_centos]# cat my_centos </span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER yyj&lt;2923979840@qq.com&gt;</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR  $MYPATH   # $为取地址符</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;----end----&quot;</span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过这个文件构建镜像</span></span><br><span class="line">[root@Mir my_centos]# docker build -f my_centos -t mycentos:0.1 .</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/10 : FROM centos</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">5d0da3dc9764</span></span><br><span class="line">Step 2/10 : MAINTAINER yyj&lt;2923979840@qq.com&gt;</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 5cbd2002f8a9</span></span><br><span class="line">Removing intermediate container 5cbd2002f8a9</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">5cd0386cd376</span></span><br><span class="line">Step 3/10 : ENV MYPATH /usr/local</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 94aee5d98fb5</span></span><br><span class="line">Removing intermediate container 94aee5d98fb5</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">c15715255426</span></span><br><span class="line">Step 4/10 : WORKDIR  $MYPATH</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 5a596eee5c36</span></span><br><span class="line">Removing intermediate container 5a596eee5c36</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">fc70fe2060b7</span></span><br><span class="line">Step 5/10 : RUN yum -y install vim</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 0a57e973d376</span></span><br><span class="line">CentOS Linux 8 - AppStream                       24  B/s |  38  B     00:01    </span><br><span class="line">Error: Failed to download metadata for repo &#x27;appstream&#x27;: Cannot prepare internal mirrorlist: No URLs in mirrorlist</span><br><span class="line">The command &#x27;/bin/sh -c yum -y install vim&#x27; returned a non-zero code: 1</span><br></pre></td></tr></table></figure>

<p><strong>报错原因：自2022年1月31日起，CentOS团队从官方镜像中移除CentOS 8的所有包，但软件包仍在官方镜像上保留一段时间。现在被转移到<a target="_blank" rel="noopener" href="https://vault.centos.org.如需继续运行旧centos/">https://vault.centos.org。如需继续运行旧CentOS</a> 8，可以在&#x2F;etc&#x2F;yum.repos中更新repos.d，使用vault.centos.org代替mirror.centos.org</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此处通过修改dockerfile解决，改为FROM centos:7</span></span><br><span class="line">[root@Mir my_centos]# cat my_centos </span><br><span class="line">FROM centos:7</span><br><span class="line">MAINTAINER yyj&lt;2923979840@qq.com&gt;</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR  $MYPATH    # $为取地址符</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;----end----&quot;</span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">再通过这个文件构建镜像</span></span><br><span class="line">[root@Mir my_centos]# docker build -f my_centos -t mycentos:0.1 .</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/10 : FROM centos:7</span><br><span class="line">7: Pulling from library/centos</span><br><span class="line">2d473b07cdd5: Pull complete </span><br><span class="line">Digest: sha256:9d4bcbbb213dfd745b58be38b13b996ebb5ac315fe75711bd618426a630e0987</span><br><span class="line">Status: Downloaded newer image for centos:7</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">eeb6ee3f44bd</span></span><br><span class="line">Step 2/10 : MAINTAINER yyj&lt;2923979840@qq.com&gt;</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> e359397ad175</span></span><br><span class="line">Removing intermediate container e359397ad175</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">d317476d2533</span></span><br><span class="line">Step 3/10 : ENV MYPATH /usr/local</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 266d54db048b</span></span><br><span class="line">Removing intermediate container 266d54db048b</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">1095fc8e0fcc</span></span><br><span class="line">Step 4/10 : WORKDIR  $MYPATH</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 7d73c31b81f0</span></span><br><span class="line">Removing intermediate container 7d73c31b81f0</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">5df1fa112612</span></span><br><span class="line">Step 5/10 : RUN yum -y install vim</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 4102b98bf13c</span></span><br><span class="line">Loaded plugins: fastestmirror, ovl</span><br><span class="line">Determining fastest mirrors</span><br><span class="line"> * base: mirrors.163.com</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.163.com</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Running transaction check</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package vim-enhanced.x86_64 2:7.4.629-8.el7_9 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: vim-common = 2:7.4.629-8.el7_9 <span class="keyword">for</span> package: 2:vim-enhanced-7.4.629-8.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: <span class="built_in">which</span> <span class="keyword">for</span> package: 2:vim-enhanced-7.4.629-8.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(:MODULE_COMPAT_5.16.3) <span class="keyword">for</span> package: 2:vim-enhanced-7.4.629-8.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: libperl.so()(64bit) <span class="keyword">for</span> package: 2:vim-enhanced-7.4.629-8.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: libgpm.so.2()(64bit) <span class="keyword">for</span> package: 2:vim-enhanced-7.4.629-8.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Running transaction check</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package gpm-libs.x86_64 0:1.20.7-6.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl.x86_64 4:5.16.3-299.el7_9 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Socket) &gt;= 1.3 <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Scalar::Util) &gt;= 1.10 <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl-macros <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(threads::shared) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(threads) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(constant) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Time::Local) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Time::HiRes) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Storable) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Socket) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Scalar::Util) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Pod::Simple::XHTML) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Pod::Simple::Search) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Getopt::Long) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Filter::Util::Call) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(File::Temp) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(File::Spec::Unix) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(File::Spec::Functions) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(File::Spec) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(File::Path) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Exporter) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Cwd) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Carp) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-libs.x86_64 4:5.16.3-299.el7_9 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package vim-common.x86_64 2:7.4.629-8.el7_9 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: vim-filesystem <span class="keyword">for</span> package: 2:vim-common-7.4.629-8.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package which.x86_64 0:2.20-7.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Running transaction check</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Carp.noarch 0:1.26-244.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Exporter.noarch 0:5.68-3.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-File-Path.noarch 0:2.09-2.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-File-Temp.noarch 0:0.23.01-3.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Filter.x86_64 0:1.49-3.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Getopt-Long.noarch 0:2.40-3.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Pod::Usage) &gt;= 1.14 <span class="keyword">for</span> package: perl-Getopt-Long-2.40-3.el7.noarch</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Text::ParseWords) <span class="keyword">for</span> package: perl-Getopt-Long-2.40-3.el7.noarch</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-PathTools.x86_64 0:3.40-5.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Pod-Simple.noarch 1:3.28-4.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Pod::Escapes) &gt;= 1.04 <span class="keyword">for</span> package: 1:perl-Pod-Simple-3.28-4.el7.noarch</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Encode) <span class="keyword">for</span> package: 1:perl-Pod-Simple-3.28-4.el7.noarch</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Scalar-List-Utils.x86_64 0:1.27-248.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Socket.x86_64 0:2.010-5.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Storable.x86_64 0:2.45-3.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Time-HiRes.x86_64 4:1.9725-3.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Time-Local.noarch 0:1.2300-2.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-constant.noarch 0:1.27-2.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-macros.x86_64 4:5.16.3-299.el7_9 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-threads.x86_64 0:1.87-4.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-threads-shared.x86_64 0:1.43-6.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package vim-filesystem.x86_64 2:7.4.629-8.el7_9 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Running transaction check</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Encode.x86_64 0:2.51-7.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Pod-Escapes.noarch 1:1.04-299.el7_9 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Pod-Usage.noarch 0:1.63-3.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Pod::Text) &gt;= 3.15 <span class="keyword">for</span> package: perl-Pod-Usage-1.63-3.el7.noarch</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl-Pod-Perldoc <span class="keyword">for</span> package: perl-Pod-Usage-1.63-3.el7.noarch</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Text-ParseWords.noarch 0:3.29-4.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Running transaction check</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Pod-Perldoc.noarch 0:3.20-4.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(parent) <span class="keyword">for</span> package: perl-Pod-Perldoc-3.20-4.el7.noarch</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(HTTP::Tiny) <span class="keyword">for</span> package: perl-Pod-Perldoc-3.20-4.el7.noarch</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: groff-base <span class="keyword">for</span> package: perl-Pod-Perldoc-3.20-4.el7.noarch</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-podlators.noarch 0:2.5.1-3.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Running transaction check</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package groff-base.x86_64 0:1.22.2-8.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-HTTP-Tiny.noarch 0:0.033-3.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-parent.noarch 1:0.225-244.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">================================================================================</span><br><span class="line"> Package                    Arch       Version                Repository   Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> vim-enhanced               x86_64     2:7.4.629-8.el7_9      updates     1.1 M</span><br><span class="line">Installing for dependencies:</span><br><span class="line"> gpm-libs                   x86_64     1.20.7-6.el7           base         32 k</span><br><span class="line"> groff-base                 x86_64     1.22.2-8.el7           base        942 k</span><br><span class="line"> perl                       x86_64     4:5.16.3-299.el7_9     updates     8.0 M</span><br><span class="line"> perl-Carp                  noarch     1.26-244.el7           base         19 k</span><br><span class="line"> perl-Encode                x86_64     2.51-7.el7             base        1.5 M</span><br><span class="line"> perl-Exporter              noarch     5.68-3.el7             base         28 k</span><br><span class="line"> perl-File-Path             noarch     2.09-2.el7             base         26 k</span><br><span class="line"> perl-File-Temp             noarch     0.23.01-3.el7          base         56 k</span><br><span class="line"> perl-Filter                x86_64     1.49-3.el7             base         76 k</span><br><span class="line"> perl-Getopt-Long           noarch     2.40-3.el7             base         56 k</span><br><span class="line"> perl-HTTP-Tiny             noarch     0.033-3.el7            base         38 k</span><br><span class="line"> perl-PathTools             x86_64     3.40-5.el7             base         82 k</span><br><span class="line"> perl-Pod-Escapes           noarch     1:1.04-299.el7_9       updates      52 k</span><br><span class="line"> perl-Pod-Perldoc           noarch     3.20-4.el7             base         87 k</span><br><span class="line"> perl-Pod-Simple            noarch     1:3.28-4.el7           base        216 k</span><br><span class="line"> perl-Pod-Usage             noarch     1.63-3.el7             base         27 k</span><br><span class="line"> perl-Scalar-List-Utils     x86_64     1.27-248.el7           base         36 k</span><br><span class="line"> perl-Socket                x86_64     2.010-5.el7            base         49 k</span><br><span class="line"> perl-Storable              x86_64     2.45-3.el7             base         77 k</span><br><span class="line"> perl-Text-ParseWords       noarch     3.29-4.el7             base         14 k</span><br><span class="line"> perl-Time-HiRes            x86_64     4:1.9725-3.el7         base         45 k</span><br><span class="line"> perl-Time-Local            noarch     1.2300-2.el7           base         24 k</span><br><span class="line"> perl-constant              noarch     1.27-2.el7             base         19 k</span><br><span class="line"> perl-libs                  x86_64     4:5.16.3-299.el7_9     updates     690 k</span><br><span class="line"> perl-macros                x86_64     4:5.16.3-299.el7_9     updates      44 k</span><br><span class="line"> perl-parent                noarch     1:0.225-244.el7        base         12 k</span><br><span class="line"> perl-podlators             noarch     2.5.1-3.el7            base        112 k</span><br><span class="line"> perl-threads               x86_64     1.87-4.el7             base         49 k</span><br><span class="line"> perl-threads-shared        x86_64     1.43-6.el7             base         39 k</span><br><span class="line"> vim-common                 x86_64     2:7.4.629-8.el7_9      updates     5.9 M</span><br><span class="line"> vim-filesystem             x86_64     2:7.4.629-8.el7_9      updates      11 k</span><br><span class="line"> which                      x86_64     2.20-7.el7             base         41 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  1 Package (+32 Dependent packages)</span><br><span class="line"></span><br><span class="line">Total download size: 19 M</span><br><span class="line">Installed size: 63 M</span><br><span class="line">Downloading packages:</span><br><span class="line">warning: /var/cache/yum/x86_64/7/base/packages/gpm-libs-1.20.7-6.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY</span><br><span class="line">Public key for gpm-libs-1.20.7-6.el7.x86_64.rpm is not installed</span><br><span class="line">Public key for perl-5.16.3-299.el7_9.x86_64.rpm is not installed</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Total                                              7.1 MB/s |  19 MB  00:02     </span><br><span class="line">Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line">Importing GPG key 0xF4A80EB5:</span><br><span class="line"> Userid     : &quot;CentOS-7 Key (CentOS 7 Official Signing Key) &lt;security@centos.org&gt;&quot;</span><br><span class="line"> Fingerprint: 6341 ab27 53d7 8a78 a7c2 7bb1 24c6 a8a7 f4a8 0eb5</span><br><span class="line"> Package    : centos-release-7-9.2009.0.el7.centos.x86_64 (@CentOS)</span><br><span class="line"> From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : gpm-libs-1.20.7-6.el7.x86_64                                1/33 </span><br><span class="line">  Installing : 2:vim-filesystem-7.4.629-8.el7_9.x86_64                     2/33 </span><br><span class="line">  Installing : 2:vim-common-7.4.629-8.el7_9.x86_64                         3/33 </span><br><span class="line">  Installing : which-2.20-7.el7.x86_64                                     4/33 </span><br><span class="line">install-info: No such file or directory for /usr/share/info/which.info.gz</span><br><span class="line">  Installing : groff-base-1.22.2-8.el7.x86_64                              5/33 </span><br><span class="line">  Installing : 1:perl-parent-0.225-244.el7.noarch                          6/33 </span><br><span class="line">  Installing : perl-HTTP-Tiny-0.033-3.el7.noarch                           7/33 </span><br><span class="line">  Installing : perl-podlators-2.5.1-3.el7.noarch                           8/33 </span><br><span class="line">  Installing : perl-Pod-Perldoc-3.20-4.el7.noarch                          9/33 </span><br><span class="line">  Installing : 1:perl-Pod-Escapes-1.04-299.el7_9.noarch                   10/33 </span><br><span class="line">  Installing : perl-Encode-2.51-7.el7.x86_64                              11/33 </span><br><span class="line">  Installing : perl-Text-ParseWords-3.29-4.el7.noarch                     12/33 </span><br><span class="line">  Installing : perl-Pod-Usage-1.63-3.el7.noarch                           13/33 </span><br><span class="line">  Installing : 4:perl-macros-5.16.3-299.el7_9.x86_64                      14/33 </span><br><span class="line">  Installing : perl-Storable-2.45-3.el7.x86_64                            15/33 </span><br><span class="line">  Installing : perl-Exporter-5.68-3.el7.noarch                            16/33 </span><br><span class="line">  Installing : perl-constant-1.27-2.el7.noarch                            17/33 </span><br><span class="line">  Installing : perl-Socket-2.010-5.el7.x86_64                             18/33 </span><br><span class="line">  Installing : perl-Time-Local-1.2300-2.el7.noarch                        19/33 </span><br><span class="line">  Installing : perl-Carp-1.26-244.el7.noarch                              20/33 </span><br><span class="line">  Installing : perl-PathTools-3.40-5.el7.x86_64                           21/33 </span><br><span class="line">  Installing : perl-Scalar-List-Utils-1.27-248.el7.x86_64                 22/33 </span><br><span class="line">  Installing : 1:perl-Pod-Simple-3.28-4.el7.noarch                        23/33 </span><br><span class="line">  Installing : perl-File-Temp-0.23.01-3.el7.noarch                        24/33 </span><br><span class="line">  Installing : perl-File-Path-2.09-2.el7.noarch                           25/33 </span><br><span class="line">  Installing : perl-threads-shared-1.43-6.el7.x86_64                      26/33 </span><br><span class="line">  Installing : perl-threads-1.87-4.el7.x86_64                             27/33 </span><br><span class="line">  Installing : 4:perl-Time-HiRes-1.9725-3.el7.x86_64                      28/33 </span><br><span class="line">  Installing : perl-Filter-1.49-3.el7.x86_64                              29/33 </span><br><span class="line">  Installing : 4:perl-libs-5.16.3-299.el7_9.x86_64                        30/33 </span><br><span class="line">  Installing : perl-Getopt-Long-2.40-3.el7.noarch                         31/33 </span><br><span class="line">  Installing : 4:perl-5.16.3-299.el7_9.x86_64                             32/33 </span><br><span class="line">  Installing : 2:vim-enhanced-7.4.629-8.el7_9.x86_64                      33/33 </span><br><span class="line">  Verifying  : perl-HTTP-Tiny-0.033-3.el7.noarch                           1/33 </span><br><span class="line">  Verifying  : perl-threads-shared-1.43-6.el7.x86_64                       2/33 </span><br><span class="line">  Verifying  : perl-Storable-2.45-3.el7.x86_64                             3/33 </span><br><span class="line">  Verifying  : groff-base-1.22.2-8.el7.x86_64                              4/33 </span><br><span class="line">  Verifying  : perl-Exporter-5.68-3.el7.noarch                             5/33 </span><br><span class="line">  Verifying  : perl-constant-1.27-2.el7.noarch                             6/33 </span><br><span class="line">  Verifying  : perl-PathTools-3.40-5.el7.x86_64                            7/33 </span><br><span class="line">  Verifying  : 4:perl-macros-5.16.3-299.el7_9.x86_64                       8/33 </span><br><span class="line">  Verifying  : 2:vim-enhanced-7.4.629-8.el7_9.x86_64                       9/33 </span><br><span class="line">  Verifying  : 1:perl-parent-0.225-244.el7.noarch                         10/33 </span><br><span class="line">  Verifying  : perl-Socket-2.010-5.el7.x86_64                             11/33 </span><br><span class="line">  Verifying  : which-2.20-7.el7.x86_64                                    12/33 </span><br><span class="line">  Verifying  : 2:vim-filesystem-7.4.629-8.el7_9.x86_64                    13/33 </span><br><span class="line">  Verifying  : perl-File-Temp-0.23.01-3.el7.noarch                        14/33 </span><br><span class="line">  Verifying  : 1:perl-Pod-Simple-3.28-4.el7.noarch                        15/33 </span><br><span class="line">  Verifying  : perl-Time-Local-1.2300-2.el7.noarch                        16/33 </span><br><span class="line">  Verifying  : 1:perl-Pod-Escapes-1.04-299.el7_9.noarch                   17/33 </span><br><span class="line">  Verifying  : perl-Carp-1.26-244.el7.noarch                              18/33 </span><br><span class="line">  Verifying  : 2:vim-common-7.4.629-8.el7_9.x86_64                        19/33 </span><br><span class="line">  Verifying  : perl-Scalar-List-Utils-1.27-248.el7.x86_64                 20/33 </span><br><span class="line">  Verifying  : perl-Pod-Usage-1.63-3.el7.noarch                           21/33 </span><br><span class="line">  Verifying  : perl-Encode-2.51-7.el7.x86_64                              22/33 </span><br><span class="line">  Verifying  : perl-Pod-Perldoc-3.20-4.el7.noarch                         23/33 </span><br><span class="line">  Verifying  : perl-podlators-2.5.1-3.el7.noarch                          24/33 </span><br><span class="line">  Verifying  : 4:perl-5.16.3-299.el7_9.x86_64                             25/33 </span><br><span class="line">  Verifying  : perl-File-Path-2.09-2.el7.noarch                           26/33 </span><br><span class="line">  Verifying  : perl-threads-1.87-4.el7.x86_64                             27/33 </span><br><span class="line">  Verifying  : 4:perl-Time-HiRes-1.9725-3.el7.x86_64                      28/33 </span><br><span class="line">  Verifying  : gpm-libs-1.20.7-6.el7.x86_64                               29/33 </span><br><span class="line">  Verifying  : perl-Filter-1.49-3.el7.x86_64                              30/33 </span><br><span class="line">  Verifying  : perl-Getopt-Long-2.40-3.el7.noarch                         31/33 </span><br><span class="line">  Verifying  : perl-Text-ParseWords-3.29-4.el7.noarch                     32/33 </span><br><span class="line">  Verifying  : 4:perl-libs-5.16.3-299.el7_9.x86_64                        33/33 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  vim-enhanced.x86_64 2:7.4.629-8.el7_9                                         </span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  gpm-libs.x86_64 0:1.20.7-6.el7                                                </span><br><span class="line">  groff-base.x86_64 0:1.22.2-8.el7                                              </span><br><span class="line">  perl.x86_64 4:5.16.3-299.el7_9                                                </span><br><span class="line">  perl-Carp.noarch 0:1.26-244.el7                                               </span><br><span class="line">  perl-Encode.x86_64 0:2.51-7.el7                                               </span><br><span class="line">  perl-Exporter.noarch 0:5.68-3.el7                                             </span><br><span class="line">  perl-File-Path.noarch 0:2.09-2.el7                                            </span><br><span class="line">  perl-File-Temp.noarch 0:0.23.01-3.el7                                         </span><br><span class="line">  perl-Filter.x86_64 0:1.49-3.el7                                               </span><br><span class="line">  perl-Getopt-Long.noarch 0:2.40-3.el7                                          </span><br><span class="line">  perl-HTTP-Tiny.noarch 0:0.033-3.el7                                           </span><br><span class="line">  perl-PathTools.x86_64 0:3.40-5.el7                                            </span><br><span class="line">  perl-Pod-Escapes.noarch 1:1.04-299.el7_9                                      </span><br><span class="line">  perl-Pod-Perldoc.noarch 0:3.20-4.el7                                          </span><br><span class="line">  perl-Pod-Simple.noarch 1:3.28-4.el7                                           </span><br><span class="line">  perl-Pod-Usage.noarch 0:1.63-3.el7                                            </span><br><span class="line">  perl-Scalar-List-Utils.x86_64 0:1.27-248.el7                                  </span><br><span class="line">  perl-Socket.x86_64 0:2.010-5.el7                                              </span><br><span class="line">  perl-Storable.x86_64 0:2.45-3.el7                                             </span><br><span class="line">  perl-Text-ParseWords.noarch 0:3.29-4.el7                                      </span><br><span class="line">  perl-Time-HiRes.x86_64 4:1.9725-3.el7                                         </span><br><span class="line">  perl-Time-Local.noarch 0:1.2300-2.el7                                         </span><br><span class="line">  perl-constant.noarch 0:1.27-2.el7                                             </span><br><span class="line">  perl-libs.x86_64 4:5.16.3-299.el7_9                                           </span><br><span class="line">  perl-macros.x86_64 4:5.16.3-299.el7_9                                         </span><br><span class="line">  perl-parent.noarch 1:0.225-244.el7                                            </span><br><span class="line">  perl-podlators.noarch 0:2.5.1-3.el7                                           </span><br><span class="line">  perl-threads.x86_64 0:1.87-4.el7                                              </span><br><span class="line">  perl-threads-shared.x86_64 0:1.43-6.el7                                       </span><br><span class="line">  vim-common.x86_64 2:7.4.629-8.el7_9                                           </span><br><span class="line">  vim-filesystem.x86_64 2:7.4.629-8.el7_9                                       </span><br><span class="line">  which.x86_64 0:2.20-7.el7                                                     </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container 4102b98bf13c</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">425490aa8811</span></span><br><span class="line">Step 6/10 : RUN yum -y install net-tools</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 576eec6342ad</span></span><br><span class="line">Loaded plugins: fastestmirror, ovl</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.163.com</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.163.com</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Running transaction check</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package net-tools.x86_64 0:2.0-0.25.20131004git.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">================================================================================</span><br><span class="line"> Package         Arch         Version                          Repository  Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> net-tools       x86_64       2.0-0.25.20131004git.el7         base       306 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 306 k</span><br><span class="line">Installed size: 917 k</span><br><span class="line">Downloading packages:</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : net-tools-2.0-0.25.20131004git.el7.x86_64                    1/1 </span><br><span class="line">  Verifying  : net-tools-2.0-0.25.20131004git.el7.x86_64                    1/1 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  net-tools.x86_64 0:2.0-0.25.20131004git.el7                                   </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container 576eec6342ad</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">0a7e55b7cdb7</span></span><br><span class="line">Step 7/10 : EXPOSE 80</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 2e7562bdfbcd</span></span><br><span class="line">Removing intermediate container 2e7562bdfbcd</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">b1e9992c5048</span></span><br><span class="line">Step 8/10 : CMD echo $MYPATH</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 125df13aa2d8</span></span><br><span class="line">Removing intermediate container 125df13aa2d8</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">7fc83e76f7b2</span></span><br><span class="line">Step 9/10 : CMD echo &quot;----end----&quot;</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> f085e3da24f8</span></span><br><span class="line">Removing intermediate container f085e3da24f8</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">bed5d18a5f8e</span></span><br><span class="line">Step 10/10 : CMD /bin/bash</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> d33ad39fe30e</span></span><br><span class="line">Removing intermediate container d33ad39fe30e</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">97891acdbe87</span></span><br><span class="line">Successfully built 97891acdbe87</span><br><span class="line">Successfully tagged mycentos:0.1</span><br></pre></td></tr></table></figure>

<p><strong>前后对比</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">官方原始的centos7，命令不全，比如缺少vim,ifconfig，并且默认工作目录为/</span></span><br><span class="line">[root@Mir my_centos]# docker run -it --name centos7-origin centos:7 /bin/bash</span><br><span class="line">[root@0535f28b7b63 /]# ifconfig</span><br><span class="line">bash: ifconfig: command not found</span><br><span class="line">[root@0535f28b7b63 /]# vim</span><br><span class="line">bash: vim: command not found</span><br><span class="line">[root@0535f28b7b63 /]# pwd</span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们在官方原始的centos7基础上构建的镜像，新添了vim和ifconfig命令</span></span><br><span class="line">[root@Mir my_centos]# docker run -it --name centos7-advanced mycentos:0.1 /bin/bash</span><br><span class="line">[root@ae0fb902150a local]# vim</span><br><span class="line">[root@ae0fb902150a local]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.6  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:ac:11:00:06  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 8  bytes 656 (656.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入容器后的默认工作目录也根据dockerfile中WORKDIR指定</span>        </span><br><span class="line">[root@ae0fb902150a local]# pwd</span><br><span class="line">/usr/local</span><br></pre></td></tr></table></figure>

<p><strong>可以通过history命令列出镜像变更历史记录</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir my_centos]# docker history 97891acdbe87 </span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2022/04/30/gjdXBm1ZCHavnQS.png" alt="image-20220428121611337"></p>
<p><strong>平时拿到镜像，可以研究一下别人是怎么做的</strong></p>
<blockquote>
<p>CMD和ENTRYPOINT 区别</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CMD			# 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代</span><br><span class="line">ENTRYPOINT  # 指定这个容器启动的时候要运行的命令，可以追加命令</span><br></pre></td></tr></table></figure>

<p><strong>测试CMD</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir my_centos]# cat cmdtest </span><br><span class="line">FROM centos:7</span><br><span class="line">CMD [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"></span><br><span class="line">[root@Mir my_centos]# docker build -f cmdtest -t cmd_test .</span><br><span class="line">Sending build context to Docker daemon  15.87kB</span><br><span class="line">Step 1/2 : FROM centos:7</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">eeb6ee3f44bd</span></span><br><span class="line">Step 2/2 : CMD [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 8cc6ba3887e1</span></span><br><span class="line">Removing intermediate container 8cc6ba3887e1</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">9dc37965152d</span></span><br><span class="line">Successfully built 9dc37965152d</span><br><span class="line">Successfully tagged cmd_test:latest</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动容器时会自动执行CMD中的命令：<span class="built_in">ls</span> -a</span></span><br><span class="line">[root@Mir my_centos]# docker run cmd_test:latest</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">anaconda-post.log</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">假如想启动时追加参数</span></span><br><span class="line">[root@Mir my_centos]# docker run cmd_test:latest -l</span><br><span class="line">docker: Error response from daemon: failed to create shim: OCI runtime create failed: container_linux.go:380: starting container process caused: exec: &quot;-l&quot;: executable file not found in $PATH: unknown.</span><br><span class="line">ERRO[0000] error waiting for container: context canceled </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CMD的清理下 -l 替换了CMD [<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;-a&quot;</span>]命令，而单独的-l不是命令所以报错</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在这种情况下要使用完整命令，如：</span></span><br><span class="line">[root@Mir my_centos]# docker run cmd_test:latest ls -al</span><br><span class="line">total 64</span><br><span class="line">drwxr-xr-x   1 root root  4096 Apr 28 04:35 .</span><br><span class="line">drwxr-xr-x   1 root root  4096 Apr 28 04:35 ..</span><br><span class="line">-rwxr-xr-x   1 root root     0 Apr 28 04:35 .dockerenv</span><br><span class="line">-rw-r--r--   1 root root 12114 Nov 13  2020 anaconda-post.log</span><br><span class="line">lrwxrwxrwx   1 root root     7 Nov 13  2020 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root   340 Apr 28 04:35 dev</span><br><span class="line">drwxr-xr-x   1 root root  4096 Apr 28 04:35 etc</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 home</span><br><span class="line">lrwxrwxrwx   1 root root     7 Nov 13  2020 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root     9 Nov 13  2020 lib64 -&gt; usr/lib64</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 media</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 mnt</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 opt</span><br><span class="line">dr-xr-xr-x 116 root root     0 Apr 28 04:35 proc</span><br><span class="line">dr-xr-x---   2 root root  4096 Nov 13  2020 root</span><br><span class="line">drwxr-xr-x  11 root root  4096 Nov 13  2020 run</span><br><span class="line">lrwxrwxrwx   1 root root     8 Nov 13  2020 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 srv</span><br><span class="line">dr-xr-xr-x  13 root root     0 Mar 18 07:51 sys</span><br><span class="line">drwxrwxrwt   7 root root  4096 Nov 13  2020 tmp</span><br><span class="line">drwxr-xr-x  13 root root  4096 Nov 13  2020 usr</span><br><span class="line">drwxr-xr-x  18 root root  4096 Nov 13  2020 var</span><br></pre></td></tr></table></figure>

<p><strong>测试ENTRYPOINT</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir my_centos]# cat entrypointtest </span><br><span class="line">FROM centos:7</span><br><span class="line">ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"></span><br><span class="line">[root@Mir my_centos]# docker build -f entrypointtest -t entrypoint_test .</span><br><span class="line">Sending build context to Docker daemon   16.9kB</span><br><span class="line">Step 1/2 : FROM centos:7</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">eeb6ee3f44bd</span></span><br><span class="line">Step 2/2 : ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> e8f917138e2f</span></span><br><span class="line">Removing intermediate container e8f917138e2f</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">969122ab5918</span></span><br><span class="line">Successfully built 969122ab5918</span><br><span class="line">Successfully tagged entrypoint_test:latest</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动时直接追加参数，可以正常执行，不会替换原命令</span></span><br><span class="line">[root@Mir my_centos]# docker run entrypoint_test:latest -l</span><br><span class="line">total 64</span><br><span class="line">drwxr-xr-x   1 root root  4096 Apr 28 04:38 .</span><br><span class="line">drwxr-xr-x   1 root root  4096 Apr 28 04:38 ..</span><br><span class="line">-rwxr-xr-x   1 root root     0 Apr 28 04:38 .dockerenv</span><br><span class="line">-rw-r--r--   1 root root 12114 Nov 13  2020 anaconda-post.log</span><br><span class="line">lrwxrwxrwx   1 root root     7 Nov 13  2020 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root   340 Apr 28 04:38 dev</span><br><span class="line">drwxr-xr-x   1 root root  4096 Apr 28 04:38 etc</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 home</span><br><span class="line">lrwxrwxrwx   1 root root     7 Nov 13  2020 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root     9 Nov 13  2020 lib64 -&gt; usr/lib64</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 media</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 mnt</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 opt</span><br><span class="line">dr-xr-xr-x 119 root root     0 Apr 28 04:38 proc</span><br><span class="line">dr-xr-x---   2 root root  4096 Nov 13  2020 root</span><br><span class="line">drwxr-xr-x  11 root root  4096 Nov 13  2020 run</span><br><span class="line">lrwxrwxrwx   1 root root     8 Nov 13  2020 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 srv</span><br><span class="line">dr-xr-xr-x  13 root root     0 Mar 18 07:51 sys</span><br><span class="line">drwxrwxrwt   7 root root  4096 Nov 13  2020 tmp</span><br><span class="line">drwxr-xr-x  13 root root  4096 Nov 13  2020 usr</span><br><span class="line">drwxr-xr-x  18 root root  4096 Nov 13  2020 var</span><br></pre></td></tr></table></figure>

<p><strong>DockerFile中很多相似命令，注意区分</strong></p>
<h3 id="实战：Tomcat镜像"><a href="#实战：Tomcat镜像" class="headerlink" title="实战：Tomcat镜像"></a>实战：Tomcat镜像</h3><ol>
<li>准备镜像文件Tomcat的压缩包，JDK压缩包（Tomcat依赖于Java）</li>
</ol>
<p><img src="https://s2.loli.net/2022/04/30/qvn9dUADxPrhOHW.png" alt="image-20220428160350946"></p>
<ol start="2">
<li>编写dockerfile文件 ,建议使用官方命名 <strong>Dockerfile</strong> ，build的时候会自动寻找这个文件，不需要  -f  指定</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:7</span><br><span class="line">MAINTAINER yyj&lt;2923979840@qq.com&gt;</span><br><span class="line"></span><br><span class="line">COPY readme.txt /usr/local/readme.txt</span><br><span class="line"></span><br><span class="line">ADD jdk-8u181-linux-x64.tar.gz /usr/local/</span><br><span class="line">ADD apache-tomcat-9.0.62.tar.gz /usr/local</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_181</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.62</span><br><span class="line">ENV CATALINA_BASE /usr/local/apache-tomcat-9.0.62</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">CMD /usr/local/apache-tomcat-9.0.62/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-9.0.62/logs/catalina.out</span><br></pre></td></tr></table></figure>

<p>​    3.构建镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir DIYTomcat]# docker build -t diytomcat</span><br></pre></td></tr></table></figure>

<p>​	4.启动镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir DIYTomcat]# docker run -d -p 9090:8080 --name yyjdiytomcat -v /home/yyj/build/tomcat/test:/usr/local/apache-tomcat-9.0.62/webapps/test -v /home/yyj/build/tomcat/tomcatlogs/:/usr/local/apache-tomcat-9.0.62/logs diytomcat</span><br></pre></td></tr></table></figure>

<p>​	5.访问测试</p>
<p><strong>用curl命令测试</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir DIYTomcat]# curl localhost:9090</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">        &lt;title&gt;Apache Tomcat/9.0.62&lt;/title&gt;</span><br><span class="line">        &lt;link href=&quot;favicon.ico&quot; rel=&quot;icon&quot; type=&quot;image/x-icon&quot; /&gt;</span><br><span class="line">        &lt;link href=&quot;tomcat.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;div id=&quot;wrapper&quot;&gt;</span><br><span class="line">      .......&lt;手动省略&gt;.......     </span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>​	<strong>浏览器测试：47.99.154.107:9090</strong></p>
<p><img src="https://s2.loli.net/2022/04/30/zuJLBmTvQRhtrA4.png" alt="image-20220429213226746"></p>
<p>6.发布项目（由于做了卷挂载，直接在本地编写项目发布就可以了，会自动同步到容器内）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir test]# pwd</span><br><span class="line">/home/yyj/build/tomcat/test</span><br><span class="line">[root@Mir test]# ls</span><br><span class="line">index.html</span><br><span class="line">[root@Mir test]# cat index.html </span><br><span class="line">CTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;title&gt;这是一个测试&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Hello,World!&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;Hello,Tomcat!&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><strong>访问  47.99.154.107：9090&#x2F;test</strong></p>
<img src="https://s2.loli.net/2022/04/30/NZ9xStihB32fr8R.png" alt="image-20220429220734296" style="zoom: 50%;" />

<p><strong>由于默认页面在 tomcat\webapps\ROOT目录下，自建项目为tomcat\webapps\test，访问时需要加上&#x2F;test</strong></p>
<h3 id="发布自己的镜像"><a href="#发布自己的镜像" class="headerlink" title="发布自己的镜像"></a>发布自己的镜像</h3><blockquote>
<p>发布到DockerHub</p>
</blockquote>
<ol>
<li>地址<a target="_blank" rel="noopener" href="https://hub.docker.com/%E6%B3%A8%E5%86%8C%E8%87%AA%E5%B7%B1%E7%9A%84%E8%B4%A6%E5%8F%B7">https://hub.docker.com/注册自己的账号</a></li>
<li>确定该账号可以登陆</li>
<li>查看login命令帮助</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir tomcatlogs]# docker login --help</span><br><span class="line"></span><br><span class="line">Usage:  docker login [OPTIONS] [SERVER]</span><br><span class="line"></span><br><span class="line">Log in to a Docker registry.</span><br><span class="line">If no server is specified, the default is defined by the daemon.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -p, --password string   Password</span><br><span class="line">      --password-stdin    Take the password from stdin</span><br><span class="line">  -u, --username string   Username</span><br></pre></td></tr></table></figure>

<p>​	4.登录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir tomcatlogs]# docker login -u miryyj</span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure>

<p>​	5.提交镜像，docker push</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker tag命令</span></span><br><span class="line">docker tag IMAGE[:TAG] [REGISTRYHOST/][USERNAME/]NAME[:TAG]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 标记本地镜像，将其归入某一仓库</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注意要push到DockerHub的镜像需要标记为：dockerhub用户名/镜像名：[tag]</span></span><br><span class="line">[root@Mir tomcatlogs]# docker tag 5d148005ef8d miryyj/diytomcat:1.0</span><br><span class="line">[root@Mir tomcatlogs]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">diytomcat             latest    5d148005ef8d   2 hours ago     823MB</span><br><span class="line">miryyj/diytomcat      1.0       5d148005ef8d   2 hours ago     823MB</span><br><span class="line">[root@Mir tomcatlogs]# docker push miryyj/diytomcat:1.0</span><br><span class="line">The push refers to repository [docker.io/miryyj/diytomcat]</span><br><span class="line">75189d352397: Pushing  43.44MB/221.1MB</span><br><span class="line">614e95fa1662: Pushed </span><br><span class="line">e10679d69db9: Pushing   25.4MB/381.7MB</span><br><span class="line">9e77174fff4b: Pushed </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">正在push，速度较慢</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>发布到阿里云镜像服务</p>
</blockquote>
<ol>
<li>进入阿里云容器镜像服务，创建个人实例</li>
</ol>
<p><img src="https://s2.loli.net/2022/04/30/IdhtBJnGwePEy6v.png" alt="image-20220430090933116"></p>
<p>​	2.创建命名空间</p>
<p><img src="https://s2.loli.net/2022/04/30/9rf2vlVsz4emZG8.png" alt="image-20220430091306626"></p>
<p>​	3.创建镜像仓库</p>
<p><img src="https://s2.loli.net/2022/04/30/NT4zd9rMWL6Ejx7.png" alt="image-20220430091543936"></p>
<p>​	4.可查看基本信息以及操作指南</p>
<p><img src="https://s2.loli.net/2022/04/30/cPIgsfFvbxD9hwd.png" alt="image-20220430091734346"></p>
<p>​	5.根据指南docker push</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><img src="https://s2.loli.net/2022/04/30/RZTsSCPFjAMqGtD.png" alt="image-20220430092606504"></p>
<h2 id="Docker网络"><a href="#Docker网络" class="headerlink" title="Docker网络"></a>Docker网络</h2><h3 id="理解Docker0"><a href="#理解Docker0" class="headerlink" title="理解Docker0"></a>理解Docker0</h3><blockquote>
<p><strong>清空所有docker环境</strong></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除所有容器</span></span><br><span class="line">[root@Mir ~]# docker rm -f $(docker ps -aq)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除所有镜像</span></span><br><span class="line">[root@Mir ~]# docker rmi -f $(docker images -aq)</span><br></pre></td></tr></table></figure>

<blockquote>
<p> <strong>测试</strong></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">用ip addr查看网络信息</span></span><br><span class="line">[root@Mir ~]# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo				#本地回环地止</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:19:a4:d8 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.23.156.252/20 brd 172.23.159.255 scope global dynamic eth0      #阿里云内网地址</span><br><span class="line">       valid_lft 311137399sec preferred_lft 311137399sec</span><br><span class="line">    inet6 fe80::216:3eff:fe19:a4d8/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link/ether 02:42:e0:0d:7a:49 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0			#docker0地址</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:e0ff:fe0d:7a49/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">三个网络</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>问题：docker如何处理容器网络访问的？</strong></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动一个Tomcat容器</span></span><br><span class="line">[root@Mir ~]# docker run -d -P --name tomcat01 tomcat</span><br><span class="line">80b1c11e483acd6a7903101a0947b09b17c7924ce9ebd1a0819675d1f4ef1b09</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入容器并安装iproute2</span></span><br><span class="line">[root@Mir ~]# docker exec -it tomcat01 /bin/bash</span><br><span class="line">root@80b1c11e483a:/usr/local/tomcat# apt update &amp;&amp; apt install iproute2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用ip addr查看容器内网络信息</span></span><br><span class="line">root@80b1c11e483a:/usr/local/tomcat# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">104: eth0@if105: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">容器启动时会得到一个ip地址，此处为eth0@if105，由docker分配</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Linux能不能ping通容器内部？</strong></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir ~]# ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.114 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.053 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.089 ms</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Linux可以ping通容器内部，因为都为172.17.0.xxx，属于同一网段</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>原理</strong></p>
</blockquote>
<ul>
<li>每启动一个docker容器，docker就会给容器分配一个ip，只要安装了docker，就会有一个docker0网卡，与物理网卡桥接，使用evth-pair技术</li>
</ul>
<blockquote>
<p><strong>再次测试ip addr</strong></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir ~]# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:19:a4:d8 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.23.156.252/20 brd 172.23.159.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 311116488sec preferred_lft 311116488sec</span><br><span class="line">    inet6 fe80::216:3eff:fe19:a4d8/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:e0:0d:7a:49 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:e0ff:fe0d:7a49/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">105: vethc8ca9cf@if104: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether 8e:cf:ca:0c:5d:62 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::8ccf:caff:fe0c:5d62/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现多了一对网卡，与tomcat01的对应</span></span><br></pre></td></tr></table></figure>

<p><strong>再启动一个容器测试</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir ~]# docker run -d -P --name tomcat02 tomcat</span><br><span class="line">b32647e88051fd2b4b30d8faba47210ed21dcb0dca4eaaabe5cb50217bcd3d3f</span><br><span class="line">[root@Mir ~]# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:19:a4:d8 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.23.156.252/20 brd 172.23.159.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 311116381sec preferred_lft 311116381sec</span><br><span class="line">    inet6 fe80::216:3eff:fe19:a4d8/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:e0:0d:7a:49 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:e0ff:fe0d:7a49/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">105: vethc8ca9cf@if104: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether 8e:cf:ca:0c:5d:62 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::8ccf:caff:fe0c:5d62/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">107: veth48ac47e@if106: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether 22:db:cf:90:3f:07 brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class="line">    inet6 fe80::20db:cfff:fe90:3f07/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现又多了一对网卡，与tomcat02对应</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>发现创建的容器带来的网卡都是成对的</strong></p>
</li>
<li><p><strong>evth-pair 就是一对的虚拟设备接口，都是成对出现，一端连着协议，一端彼此相连</strong></p>
</li>
<li><p><strong>因为这个特性，evth-pair充当一个桥梁，连接各种虚拟网络设备的</strong></p>
</li>
<li><p><strong>OpenStac，Docker容器之间的连接，OVS的连接，都是使用evth-pair技术</strong></p>
</li>
</ul>
<blockquote>
<p><strong>测试容器之间能够ping通</strong></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在tomcat02(172.17.0.3)内ping  tomcat01(172.17.0.2)</span></span><br><span class="line">root@b32647e88051:/usr/local/tomcat# ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2): 56 data bytes</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=0 ttl=64 time=0.221 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.067 ms</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">结论：容器与容器之间可以通信</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>网络模型图</strong></p>
</blockquote>
<img src="https://s2.loli.net/2022/04/30/jeLmnvsNWl2oVbr.png" alt="image-20220430155902766" style="zoom: 67%;" />

<ul>
<li><p><strong>tomcat01和tomcat02公用一个路由器docker0</strong></p>
</li>
<li><p><strong>所有的容器在不指定网络的情况下，都是通过docker0路由的，docker会给容器分配一个默认的可用IP</strong></p>
</li>
<li><p><strong>由&#x2F;16可知该网络地址前16位为网络地址，后16位为主机地址，一个docker可以分配大约255*255的私有ip</strong></p>
</li>
</ul>
<blockquote>
<p><strong>总结</strong></p>
</blockquote>
<p><strong>docker使用的是Linux的桥接，宿主机中是一个docker容器的网桥docker0</strong></p>
<img src="https://s2.loli.net/2022/04/30/3HqcrPBR5o7eZ1S.png" alt="image-20220430160852542" style="zoom: 50%;" />

<ul>
<li><strong>docker中所有的网络接口都是虚拟的，转发效率高，相当于内网传输</strong></li>
<li><strong>只要容器删除，则对应一对网桥就被删除</strong></li>
</ul>
<h3 id="–link"><a href="#–link" class="headerlink" title="–link"></a>–link</h3><p><strong>当项目重启时，ip换掉了，希望可以通过名字来访问容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在tomcat01中直接ping tomcat02名字</span></span><br><span class="line">root@80b1c11e483a:/usr/local/tomcat# ping tomcat02</span><br><span class="line">ping: unknown host</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现无法ping通</span></span><br></pre></td></tr></table></figure>

<p><strong>解决方法</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">新建容器tomcat03，使用--<span class="built_in">link</span>将tomcat02与tomcat网络相连</span></span><br><span class="line">[root@Mir ~]# docker run -d -P --name tomcat03 --link tomcat02 tomcat</span><br><span class="line">556e868784c4c5172a0c643a824234b8f36aa116ab1d5d1d2d24b7ad760e6945</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现进入容器tomcat02无法ping通tomcat03</span></span><br><span class="line">[root@Mir ~]# docker exec -it tomcat02 /bin/bash</span><br><span class="line">root@b32647e88051:/usr/local/tomcat# ping tomcat03</span><br><span class="line">ping: unknown host</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">只能tomcat03 ping通tomcat02</span></span><br><span class="line">root@556e868784c4:/usr/local/tomcat# ping tomcat02</span><br><span class="line">PING tomcat02 (172.17.0.3): 56 data bytes</span><br><span class="line">64 bytes from 172.17.0.3: icmp_seq=0 ttl=64 time=0.140 ms</span><br><span class="line">64 bytes from 172.17.0.3: icmp_seq=1 ttl=64 time=0.122 ms</span><br></pre></td></tr></table></figure>

<p><strong>引入：docker network命令</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询帮助</span></span><br><span class="line">[root@Mir ~]# docker network --help</span><br><span class="line">Usage:  docker network COMMAND</span><br><span class="line">Manage networks</span><br><span class="line">Commands:</span><br><span class="line">  connect     Connect a container to a network</span><br><span class="line">  create      Create a network</span><br><span class="line">  disconnect  Disconnect a container from a network</span><br><span class="line">  inspect     Display detailed information on one or more networks</span><br><span class="line">  ls          List networks</span><br><span class="line">  prune       Remove all unused networks</span><br><span class="line">  rm          Remove one or more networks</span><br><span class="line">Run &#x27;docker network COMMAND --help&#x27; for more information on a command.</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看网络列表</span></span><br><span class="line">[root@Mir ~]# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">a43851655b4a   bridge    bridge    local</span><br><span class="line">20b70f348e7e   host      host      local</span><br><span class="line">f9238c707f47   none      null      local</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查其中bridge网络的信息(猜测为docker0的信息)</span></span><br><span class="line">[root@Mir ~]# docker network inspect a43851655b4a</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;a43851655b4a108b037207aa6027242fd42d48debf90ee2a7eb6a61ab4913fe1&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2022-03-18T11:19:51.362481253+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: null,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;172.17.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;556e868784c4c5172a0c643a824234b8f36aa116ab1d5d1d2d24b7ad760e6945&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat03&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;bb7009ea5d00d8f9cabfbf6aa190961a76052f2884582149984236b328d8ebfa&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:04&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.17.0.4/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;80b1c11e483acd6a7903101a0947b09b17c7924ce9ebd1a0819675d1f4ef1b09&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;c99fff49f0aa35b42e31840fee370ecabdf8d48f4f3492047f4a9cb8b05a793a&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.17.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;b32647e88051fd2b4b30d8faba47210ed21dcb0dca4eaaabe5cb50217bcd3d3f&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;57e42eb233165b72c3ce3672e8b0ad274bcb63d8816be961110db97598cfd6af&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.17.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;</span><br><span class="line">            &quot;com.docker.network.bridge.default_bridge&quot;: &quot;true&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.enable_icc&quot;: &quot;true&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.enable_ip_masquerade&quot;: &quot;true&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.host_binding_ipv4&quot;: &quot;0.0.0.0&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.name&quot;: &quot;docker0&quot;,</span><br><span class="line">            &quot;com.docker.network.driver.mtu&quot;: &quot;1500&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>其实tomcat03就是在其容器内部配置了tomcat02的信息</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看tomcat03的hosts配置</span></span><br><span class="line">root@556e868784c4:/usr/local/tomcat# cat /etc/hosts</span><br><span class="line">127.0.0.1	localhost</span><br><span class="line">::1	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0	ip6-localnet</span><br><span class="line">ff00::0	ip6-mcastprefix</span><br><span class="line">ff02::1	ip6-allnodes</span><br><span class="line">ff02::2	ip6-allrouters</span><br><span class="line">172.17.0.3	tomcat02 b32647e88051   # 发现这里添加了tomcat02的ip地址</span><br><span class="line">172.17.0.4	556e868784c4</span><br></pre></td></tr></table></figure>

<p><strong>但是现在已经不建议使用–link了，我们需要的是自定义网络，不使用docker0</strong></p>
<p><strong>docker0的问题：不支持容器名连接访问</strong></p>
<h3 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h3><blockquote>
<p><strong>查看所有docker网络</strong></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir ~]# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">a43851655b4a   bridge    bridge    local</span><br><span class="line">20b70f348e7e   host      host      local</span><br><span class="line">f9238c707f47   none      null      local</span><br></pre></td></tr></table></figure>

<p><strong>网络模式</strong></p>
<ul>
<li>bridge（默认）：桥接，在docker上搭桥</li>
<li>none：不配置网络</li>
<li>host：和宿主机共享网络</li>
<li>container：容器网络互通（用得少，局限性大）</li>
</ul>
<p><strong>测试</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清空docker网络环境，删除所有容器</span></span><br><span class="line">[root@Mir ~]# docker rm -f $(docker ps -aq)</span><br><span class="line">556e868784c4</span><br><span class="line">b32647e88051</span><br><span class="line">80b1c11e483a</span><br><span class="line">[root@Mir ~]# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:19:a4:d8 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.23.156.252/20 brd 172.23.159.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 311110546sec preferred_lft 311110546sec</span><br><span class="line">    inet6 fe80::216:3eff:fe19:a4d8/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link/ether 02:42:e0:0d:7a:49 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:e0ff:fe0d:7a49/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通常直接使用第一种启动方式，实际上省略了默认的参数 --net bridge</span></span><br><span class="line">[root@Mir ~]# docker run -d -P --name tomcat01 tomcat</span><br><span class="line">[root@Mir ~]# docker run -d -P --name tomcat01 --net bridge tomcat</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker0特点：默认网络，域名不能访问，--<span class="built_in">link</span>可以打通各容器</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们可以自定义网络</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询docker network create命令帮助</span></span><br><span class="line">[root@Mir ~]# docker network create --help</span><br><span class="line">Usage:  docker network create [OPTIONS] NETWORK</span><br><span class="line">Create a network</span><br><span class="line">Options:</span><br><span class="line">      --attachable           Enable manual container attachment</span><br><span class="line">      --aux-address map      Auxiliary IPv4 or IPv6 addresses used by Network driver (default map[])</span><br><span class="line">      --config-from string   The network from which to copy the configuration</span><br><span class="line">      --config-only          Create a configuration only network</span><br><span class="line">  -d, --driver string        Driver to manage the Network (default &quot;bridge&quot;)   #网络模式</span><br><span class="line">      --gateway strings      IPv4 or IPv6 Gateway for the master subnet  	#网关</span><br><span class="line">      --ingress              Create swarm routing-mesh network</span><br><span class="line">      --internal             Restrict external access to the network</span><br><span class="line">      --ip-range strings     Allocate container ip from a sub-range</span><br><span class="line">      --ipam-driver string   IP Address Management Driver (default &quot;default&quot;)</span><br><span class="line">      --ipam-opt map         Set IPAM driver specific options (default map[])</span><br><span class="line">      --ipv6                 Enable IPv6 networking</span><br><span class="line">      --label list           Set metadata on a network</span><br><span class="line">  -o, --opt map              Set driver specific options (default map[])</span><br><span class="line">      --scope string         Control the network&#x27;s scope</span><br><span class="line">      --subnet strings       Subnet in CIDR format that represents a network segment #子网</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建网络</span></span><br><span class="line">--driver bridge     		# 网络模式为bridge</span><br><span class="line">--subnet 192.168.0.0/16		# 子网，192.168.0.2~192.168.255.255</span><br><span class="line">--gateway 192.168.0.1		# 网关</span><br><span class="line">[root@Mir ~]# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span><br><span class="line">817b82cace2d85fd3286028801f7ef858deeba2f2c9fab6277e3e3ad0322c9ae</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看网络列表</span></span><br><span class="line">[root@Mir ~]# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">a43851655b4a   bridge    bridge    local</span><br><span class="line">20b70f348e7e   host      host      local</span><br><span class="line">817b82cace2d   mynet     bridge    local</span><br><span class="line">f9238c707f47   none      null      local</span><br></pre></td></tr></table></figure>

<p><strong>自定义网络创建完成</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir ~]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;mynet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;817b82cace2d85fd3286028801f7ef858deeba2f2c9fab6277e3e3ad0322c9ae&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2022-04-30T17:13:11.323068667+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>测试</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建两个容器tomcat01 tomcat02</span></span><br><span class="line">[root@Mir ~]# docker run -d -P --name tomcat01 --net mynet tomcat</span><br><span class="line">51908428ba5f0e32501ae14b635db734a406aa1381a308d80dadce56719c6d17</span><br><span class="line">[root@Mir ~]# docker run -d -P --name tomcat02 --net mynet tomcat</span><br><span class="line">d8683b2d942029224beced57ac2a0596fe17711542c9078b8d3726da5ee119c2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看mynet信息</span></span><br><span class="line">[root@Mir ~]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;mynet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;817b82cace2d85fd3286028801f7ef858deeba2f2c9fab6277e3e3ad0322c9ae&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2022-04-30T17:13:11.323068667+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;51908428ba5f0e32501ae14b635db734a406aa1381a308d80dadce56719c6d17&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;67825ed8b4676e68b083d6129e9fcbdf6e03736cc41b4d41a64ae93a242a7e9a&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;d8683b2d942029224beced57ac2a0596fe17711542c9078b8d3726da5ee119c2&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;d6ed812fd4710d63dbcd4e8f26dca93e7d0755318d544efe78198f24792804ac&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可以直接通过容器名双向ping通</span></span><br><span class="line">root@51908428ba5f:/usr/local/tomcat# ping tomcat02</span><br><span class="line">PING tomcat02 (192.168.0.3): 56 data bytes</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=0 ttl=64 time=0.217 ms</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=1 ttl=64 time=0.081 ms</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">现在不使用--<span class="built_in">link</span>也可以互相ping通</span></span><br></pre></td></tr></table></figure>

<p><strong>我们自定义的网络，docker已经帮我们维护好了对应的关系，建议使用这种方式</strong></p>
<p><strong>好处：假如希望搭建MySQL集群或者Redis集群，可以分别搭建一个MySQL网络和Redis网络，不同的集群使用不同的网络，而网络之间是隔离的，保证集群的安全（但二者之间也可以打通）</strong></p>
<p><img src="https://s2.loli.net/2022/04/30/o3kv7sARxJq6Ewe.png" alt="image-20220430175758494"></p>
<h3 id="网络连通"><a href="#网络连通" class="headerlink" title="网络连通"></a>网络连通</h3><p><strong>docker network connect 命令</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看命令帮助</span></span><br><span class="line">[root@Mir ~]# docker network connect --help</span><br><span class="line">Usage:  docker network connect [OPTIONS] NETWORK CONTAINER</span><br><span class="line">Connect a container to a network</span><br><span class="line">Options:</span><br><span class="line">      --alias strings           Add network-scoped alias for the container</span><br><span class="line">      --driver-opt strings      driver options for the network</span><br><span class="line">      --ip string               IPv4 address (e.g., 172.30.100.104)</span><br><span class="line">      --ip6 string              IPv6 address (e.g., 2001:db8::33)</span><br><span class="line">      --link list               Add link to another container</span><br><span class="line">      --link-local-ip strings   Add a link-local address for the container</span><br></pre></td></tr></table></figure>

<p><strong>此小节网络结构背景图：</strong></p>
<img src="https://s2.loli.net/2022/04/30/uIhPOftKj4RXDxT.png" alt="image-20220430181630650" style="zoom:67%;" />

<p><strong>测试打通tomcat03到mynet</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir ~]# docker network connect mynet tomcat03</span><br><span class="line">[root@Mir ~]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;mynet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;817b82cace2d85fd3286028801f7ef858deeba2f2c9fab6277e3e3ad0322c9ae&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2022-04-30T17:13:11.323068667+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;51908428ba5f0e32501ae14b635db734a406aa1381a308d80dadce56719c6d17&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;67825ed8b4676e68b083d6129e9fcbdf6e03736cc41b4d41a64ae93a242a7e9a&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;64501e248789b9deb443e621c549500f1871032826ff50f994bd3ac46d909bc7&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat03&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;f2416e80de4c494aecbd0601d73957f1bdf0d093a2130aae68c18355288dcce6&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:04&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.4/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;d8683b2d942029224beced57ac2a0596fe17711542c9078b8d3726da5ee119c2&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;d6ed812fd4710d63dbcd4e8f26dca93e7d0755318d544efe78198f24792804ac&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>连通之后直接把tomcat03加入mynet网络，一个容器，两个IP，同时处于mynet和docker0网络下</strong></p>
<p><strong>测试能否直接ping通：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@Mir ~]# docker exec -it tomcat01 ping tomcat03</span><br><span class="line">PING tomcat03 (192.168.0.4): 56 data bytes</span><br><span class="line">64 bytes from 192.168.0.4: icmp_seq=0 ttl=64 time=0.189 ms</span><br><span class="line">64 bytes from 192.168.0.4: icmp_seq=1 ttl=64 time=0.083 ms</span><br></pre></td></tr></table></figure>

<p><strong>总结：docker内要跨网络连接别人，就必须要使用docker network connect 连通</strong></p>
<h3 id="实战：部署Redis集群"><a href="#实战：部署Redis集群" class="headerlink" title="实战：部署Redis集群"></a>实战：部署Redis集群</h3><p><em><strong>未完待续……</strong></em></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">TROUVAILLE</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/08/08/Docker/">http://example.com/2023/08/08/Docker/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">怺恆のBLOG</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Docker/">Docker</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/YuJiang4319/WallPaper@master/%E9%AC%BC%E5%88%80/Dome4_4k.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/08/08/Docker%E9%83%A8%E7%BD%B2Halo/" title="Docker部署Halo"><img class="cover" src="https://cdn.jsdelivr.net/gh/YuJiang4319/WallPaper@master/%E9%AC%BC%E5%88%80/26%20(2).jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Docker部署Halo</div></div></a></div><div class="next-post pull-right"><a href="/2023/08/08/MySQL%E5%9F%BA%E7%A1%80/" title="MySQL基础"><img class="cover" src="https://cdn.jsdelivr.net/gh/YuJiang4319/WallPaper@master/%E9%AC%BC%E5%88%80/Shine2_4k.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MySQL基础</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/08/08/Docker%E9%83%A8%E7%BD%B2Halo/" title="Docker部署Halo"><img class="cover" src="https://cdn.jsdelivr.net/gh/YuJiang4319/WallPaper@master/%E9%AC%BC%E5%88%80/26%20(2).jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-08</div><div class="title">Docker部署Halo</div></div></a></div><div><a href="/2023/09/30/iKuai%E4%BD%BF%E7%94%A8docker%E5%AE%89%E8%A3%85qBittorrent/" title="iKuai使用docker安装qBittorrent"><img class="cover" src="https://cdn.jsdelivr.net/gh/YuJiang4319/WallPaper@master/%E9%AC%BC%E5%88%80/2_Stella3_4k_3b122.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-30</div><div class="title">iKuai使用docker安装qBittorrent</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/YuJiang4319/WallPaper@master/%E9%AC%BC%E5%88%80/ahead1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">TROUVAILLE</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/YuJiang4319"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/YuJiang4319" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://t.me/miryang4319" target="_blank" title="电报"><i class="fab fa-telegram" style="color: #279fdb;"></i></a><a class="social-icon" href="https://space.bilibili.com/346306073" target="_blank" title="B站"><i class="fab fa-bilibili" style="color: #009fd6;"></i></a><a class="social-icon" href="https://www.youtube.com/channel/UCwGwgTFgCd5TSXYAwFNQiEw" target="_blank" title="油管"><i class="fab fa-youtube" style="color: #ff0000;"></i></a><a class="social-icon" href="https://twitter.com/YangMir5" target="_blank" title="推特"><i class="fab fa-square-x-twitter" style="color: #0b1016;"></i></a><a class="social-icon" href="mailto:miryang4319@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Hi,Friend！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker%E7%AC%94%E8%AE%B0"><span class="toc-number">1.</span> <span class="toc-text">Docker笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">Docker概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker%E4%B8%BA%E4%BB%80%E4%B9%88%E5%87%BA%E7%8E%B0%EF%BC%9F"><span class="toc-number">1.1.1.</span> <span class="toc-text">docker为什么出现？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E5%8E%86%E5%8F%B2"><span class="toc-number">1.2.</span> <span class="toc-text">Docker历史</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E8%83%BD%E5%B9%B2%E5%98%9B"><span class="toc-number">1.3.</span> <span class="toc-text">Docker能干嘛</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E5%AE%89%E8%A3%85"><span class="toc-number">1.4.</span> <span class="toc-text">Docker安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90"><span class="toc-number">1.4.1.</span> <span class="toc-text">Docker基本组成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Docker"><span class="toc-number">1.4.2.</span> <span class="toc-text">安装Docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F"><span class="toc-number">1.4.3.</span> <span class="toc-text">阿里云镜像加速</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.4.</span> <span class="toc-text">底层原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.</span> <span class="toc-text">Docker常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.1.</span> <span class="toc-text">帮助命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.2.</span> <span class="toc-text">镜像命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.3.</span> <span class="toc-text">容器命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.4.</span> <span class="toc-text">常用其他命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">1.5.5.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0"><span class="toc-number">1.6.</span> <span class="toc-text">练习</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">1.7.</span> <span class="toc-text">可视化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E9%95%9C%E5%83%8F%E8%AE%B2%E8%A7%A3"><span class="toc-number">1.8.</span> <span class="toc-text">Docker镜像讲解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">1.8.1.</span> <span class="toc-text">镜像是什么？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86"><span class="toc-number">1.8.2.</span> <span class="toc-text">Docker镜像加载原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B1%82%E7%90%86%E8%A7%A3"><span class="toc-number">1.8.3.</span> <span class="toc-text">分层理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Commit%E9%95%9C%E5%83%8F"><span class="toc-number">1.8.4.</span> <span class="toc-text">Commit镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.9.</span> <span class="toc-text">容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7%EF%BC%9F"><span class="toc-number">1.9.1.</span> <span class="toc-text">什么是容器数据卷？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%8D%B7%EF%BC%9A"><span class="toc-number">1.9.2.</span> <span class="toc-text">使用数据卷：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%EF%BC%9A%E5%AE%89%E8%A3%85MySQL"><span class="toc-number">1.9.3.</span> <span class="toc-text">实战：安装MySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E5%90%8D%E5%92%8C%E5%8C%BF%E5%90%8D%E6%8C%82%E8%BD%BD"><span class="toc-number">1.9.4.</span> <span class="toc-text">具名和匿名挂载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E8%AF%86DockerFile"><span class="toc-number">1.9.5.</span> <span class="toc-text">初识DockerFile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8"><span class="toc-number">1.9.6.</span> <span class="toc-text">数据卷容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DcockerFile"><span class="toc-number">1.9.7.</span> <span class="toc-text">DcockerFile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DockerFile%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="toc-number">1.9.8.</span> <span class="toc-text">DockerFile构建过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DockerFile-%E7%9A%84%E6%8C%87%E4%BB%A4"><span class="toc-number">1.9.9.</span> <span class="toc-text">DockerFile 的指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%B5%8B%E8%AF%95"><span class="toc-number">1.9.10.</span> <span class="toc-text">实战测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%EF%BC%9ATomcat%E9%95%9C%E5%83%8F"><span class="toc-number">1.9.11.</span> <span class="toc-text">实战：Tomcat镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84%E9%95%9C%E5%83%8F"><span class="toc-number">1.9.12.</span> <span class="toc-text">发布自己的镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.9.13.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E7%BD%91%E7%BB%9C"><span class="toc-number">1.10.</span> <span class="toc-text">Docker网络</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%90%86%E8%A7%A3Docker0"><span class="toc-number">1.10.1.</span> <span class="toc-text">理解Docker0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%93link"><span class="toc-number">1.10.2.</span> <span class="toc-text">–link</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C"><span class="toc-number">1.10.3.</span> <span class="toc-text">自定义网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%BF%9E%E9%80%9A"><span class="toc-number">1.10.4.</span> <span class="toc-text">网络连通</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%EF%BC%9A%E9%83%A8%E7%BD%B2Redis%E9%9B%86%E7%BE%A4"><span class="toc-number">1.10.5.</span> <span class="toc-text">实战：部署Redis集群</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/08/05/Git%E5%B7%A5%E4%BD%9C%E6%B5%81%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" title="Git工作流常用命令"><img src="https://cdn.jsdelivr.net/gh/YuJiang4319/WallPaper@master/%E9%AC%BC%E5%88%80/Dome4_4k.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Git工作流常用命令"/></a><div class="content"><a class="title" href="/2024/08/05/Git%E5%B7%A5%E4%BD%9C%E6%B5%81%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" title="Git工作流常用命令">Git工作流常用命令</a><time datetime="2024-08-05T08:25:38.000Z" title="发表于 2024-08-05 16:25:38">2024-08-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/16/Google%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8D%A1%E9%A1%BF%E8%A7%A3%E5%86%B3/" title="Google浏览器卡顿解决"><img src="https://cdn.jsdelivr.net/gh/YuJiang4319/WallPaper@master/%E9%AC%BC%E5%88%80/1%20(9).jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Google浏览器卡顿解决"/></a><div class="content"><a class="title" href="/2023/11/16/Google%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8D%A1%E9%A1%BF%E8%A7%A3%E5%86%B3/" title="Google浏览器卡顿解决">Google浏览器卡顿解决</a><time datetime="2023-11-16T08:55:38.000Z" title="发表于 2023-11-16 16:55:38">2023-11-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/15/wireshark%E6%8A%93%E5%8C%85%E5%88%86%E6%9E%90dns%E3%80%81http%E5%8D%8F%E8%AE%AE/" title="wireshark抓包分析dns、http协议"><img src="https://cdn.jsdelivr.net/gh/YuJiang4319/WallPaper@master/%E9%AC%BC%E5%88%80/Dome2_2_4k.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="wireshark抓包分析dns、http协议"/></a><div class="content"><a class="title" href="/2023/10/15/wireshark%E6%8A%93%E5%8C%85%E5%88%86%E6%9E%90dns%E3%80%81http%E5%8D%8F%E8%AE%AE/" title="wireshark抓包分析dns、http协议">wireshark抓包分析dns、http协议</a><time datetime="2023-10-15T08:55:38.000Z" title="发表于 2023-10-15 16:55:38">2023-10-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/10/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" title="常用命令"><img src="https://cdn.jsdelivr.net/gh/YuJiang4319/WallPaper@master/%E9%AC%BC%E5%88%80/31_Ball2_8k.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="常用命令"/></a><div class="content"><a class="title" href="/2023/10/10/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" title="常用命令">常用命令</a><time datetime="2023-10-10T08:55:38.000Z" title="发表于 2023-10-10 16:55:38">2023-10-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/08/GitHub%E6%96%87%E4%BB%B6%E7%94%9F%E6%88%90%E4%B8%8B%E8%BD%BD%E9%93%BE%E6%8E%A5/" title="GitHub文件生成下载链接"><img src="https://cdn.jsdelivr.net/gh/YuJiang4319/WallPaper@master/%E9%AC%BC%E5%88%80/36_lion3_4k_7c4c3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GitHub文件生成下载链接"/></a><div class="content"><a class="title" href="/2023/10/08/GitHub%E6%96%87%E4%BB%B6%E7%94%9F%E6%88%90%E4%B8%8B%E8%BD%BD%E9%93%BE%E6%8E%A5/" title="GitHub文件生成下载链接">GitHub文件生成下载链接</a><time datetime="2023-10-08T05:55:38.000Z" title="发表于 2023-10-08 13:55:38">2023-10-08</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/YuJiang4319/WallPaper@master/%E9%AC%BC%E5%88%80/Dome4_4k.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By TROUVAILLE</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, Friend!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">簡</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="true"></script></div></body></html>